{
  "_content": {
    "Summary": {
      "children": [
        {
          "type": "Paragraph",
          "data": {
            "children": [
              {
                "type": "Words",
                "data": {
                  "value": "Semaphore"
                }
              }
            ]
          }
        }
      ]
    },
    "Extended Summary": {
      "children": [
        {
          "type": "Paragraph",
          "data": {
            "children": [
              {
                "type": "Words",
                "data": {
                  "value": "This "
                }
              },
              {
                "type": "Directive",
                "data": {
                  "value": [
                    "semaphore",
                    " ",
                    "<https",
                    ":",
                    "//en.wikipedia.org/wiki/Semaphore",
                    "_",
                    "(programming)>"
                  ],
                  "domain": null,
                  "role": null
                }
              },
              {
                "type": "Words",
                "data": {
                  "value": "_ will track leases on the scheduler which can be acquired and released by an instance of this class. If the maximum amount of leases are already acquired, it is not possible to acquire more and the caller waits until another lease has been released."
                }
              }
            ]
          }
        },
        {
          "type": "Paragraph",
          "data": {
            "children": [
              {
                "type": "Words",
                "data": {
                  "value": "The lifetime or leases are controlled using a timeout. This timeout is refreshed in regular intervals by the "
                }
              },
              {
                "type": "Verbatim",
                "data": {
                  "value": [
                    "Client"
                  ]
                }
              },
              {
                "type": "Words",
                "data": {
                  "value": " of this instance and provides protection from deadlocks or resource starvation in case of worker failure. The timeout can be controlled using the configuration option "
                }
              },
              {
                "type": "Verbatim",
                "data": {
                  "value": [
                    "distributed.scheduler.locks.lease-timeout"
                  ]
                }
              },
              {
                "type": "Words",
                "data": {
                  "value": " and the interval in which the scheduler verifies the timeout is set using the option "
                }
              },
              {
                "type": "Verbatim",
                "data": {
                  "value": [
                    "distributed.scheduler.locks.lease-validation-interval"
                  ]
                }
              },
              {
                "type": "Words",
                "data": {
                  "value": "."
                }
              }
            ]
          }
        },
        {
          "type": "Paragraph",
          "data": {
            "children": [
              {
                "type": "Words",
                "data": {
                  "value": "A noticeable difference to the Semaphore of the python standard library is that this implementation does not allow to release more often than it was acquired. If this happens, a warning is emitted but the internal state is not modified."
                }
              }
            ]
          }
        },
        {
          "type": "BlockDirective",
          "data": {
            "lines": {
              "_lines": [
                {
                  "_line": ".. warning::",
                  "_number": 20,
                  "_offset": 0
                }
              ]
            },
            "wh": {
              "_lines": [
                {
                  "_line": "",
                  "_number": 21,
                  "_offset": 0
                }
              ]
            },
            "ind": {
              "_lines": [
                {
                  "_line": "    This implementation is still in an experimental state and subtle",
                  "_number": 22,
                  "_offset": 0
                },
                {
                  "_line": "    changes in behavior may occur without any change in the major version",
                  "_number": 23,
                  "_offset": 0
                },
                {
                  "_line": "    of this library.",
                  "_number": 24,
                  "_offset": 0
                },
                {
                  "_line": "",
                  "_number": 25,
                  "_offset": 0
                }
              ]
            },
            "directive_name": "warning",
            "args0": [
              ""
            ],
            "inner": {
              "children": [
                {
                  "type": "Words",
                  "data": {
                    "value": "This implementation is still in an experimental state and subtle changes in behavior may occur without any change in the major version of this library. "
                  }
                }
              ]
            }
          }
        },
        {
          "type": "BlockDirective",
          "data": {
            "lines": {
              "_lines": [
                {
                  "_line": ".. warning::",
                  "_number": 26,
                  "_offset": 0
                }
              ]
            },
            "wh": {
              "_lines": [
                {
                  "_line": "",
                  "_number": 27,
                  "_offset": 0
                }
              ]
            },
            "ind": {
              "_lines": [
                {
                  "_line": "    This implementation is susceptible to lease overbooking in case of",
                  "_number": 28,
                  "_offset": 0
                },
                {
                  "_line": "    lease timeouts. It is advised to monitor log information and adjust",
                  "_number": 29,
                  "_offset": 0
                },
                {
                  "_line": "    above configuration options to suitable values for the user application.",
                  "_number": 30,
                  "_offset": 0
                }
              ]
            },
            "directive_name": "warning",
            "args0": [
              ""
            ],
            "inner": {
              "children": [
                {
                  "type": "Words",
                  "data": {
                    "value": "This implementation is susceptible to lease overbooking in case of lease timeouts. It is advised to monitor log information and adjust above configuration options to suitable values for the user application."
                  }
                }
              ]
            }
          }
        }
      ]
    },
    "Parameters": {
      "children": [
        {
          "type": "Param",
          "data": {
            "param": "max_leases: int (optional)",
            "type_": "",
            "desc": [
              {
                "type": "Paragraph",
                "data": {
                  "children": [
                    {
                      "type": "Words",
                      "data": {
                        "value": "The maximum amount of leases that may be granted at the same time. This effectively sets an upper limit to the amount of parallel access to a specific resource. Defaults to 1."
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "type": "Param",
          "data": {
            "param": "name: string (optional)",
            "type_": "",
            "desc": [
              {
                "type": "Paragraph",
                "data": {
                  "children": [
                    {
                      "type": "Words",
                      "data": {
                        "value": "Name of the semaphore to acquire.  Choosing the same name allows two disconnected processes to coordinate.  If not given, a random name will be generated."
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "type": "Param",
          "data": {
            "param": "register: bool",
            "type_": "",
            "desc": [
              {
                "type": "Paragraph",
                "data": {
                  "children": [
                    {
                      "type": "Words",
                      "data": {
                        "value": "If True, register the semaphore with the scheduler. This needs to be done before any leases can be acquired. If not done during initialization, this can also be done by calling the register method of this class. When registering, this needs to be awaited."
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "type": "Param",
          "data": {
            "param": "scheduler_rpc: ConnectionPool",
            "type_": "",
            "desc": [
              {
                "type": "Paragraph",
                "data": {
                  "children": [
                    {
                      "type": "Words",
                      "data": {
                        "value": "The ConnectionPool to connect to the scheduler. If None is provided, it uses the worker or client pool. This paramter is mostly used for testing."
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        {
          "type": "Param",
          "data": {
            "param": "loop: IOLoop",
            "type_": "",
            "desc": [
              {
                "type": "Paragraph",
                "data": {
                  "children": [
                    {
                      "type": "Words",
                      "data": {
                        "value": "The event loop this instance is using. If None is provided, reuse the loop of the active worker or client."
                      }
                    }
                  ]
                }
              }
            ]
          }
        }
      ]
    },
    "Returns": {
      "children": []
    },
    "Yields": {
      "children": []
    },
    "Receives": {
      "children": []
    },
    "Raises": {
      "children": []
    },
    "Warns": {
      "children": []
    },
    "Other Parameters": {
      "children": []
    },
    "Attributes": {
      "children": []
    },
    "Methods": {
      "children": []
    },
    "Notes": {
      "children": [
        {
          "type": "Paragraph",
          "data": {
            "children": [
              {
                "type": "Words",
                "data": {
                  "value": "If a client attempts to release the semaphore but doesn't have a lease acquired, this will raise an exception."
                }
              }
            ]
          }
        },
        {
          "type": "Paragraph",
          "data": {
            "children": [
              {
                "type": "Words",
                "data": {
                  "value": "When a semaphore is closed, if, for that closed semaphore, a client attempts to:"
                }
              }
            ]
          }
        },
        {
          "type": "Paragraph",
          "data": {
            "children": [
              {
                "type": "Words",
                "data": {
                  "value": "- Acquire a lease: an exception will be raised. - Release: a warning will be logged. - Close: nothing will happen."
                }
              }
            ]
          }
        },
        {
          "type": "Paragraph",
          "data": {
            "children": [
              {
                "type": "Words",
                "data": {
                  "value": "dask executes functions by default assuming they are pure, when using semaphore acquire/releases inside such a function, it must be noted that there *are* in fact side-effects, thus, the function can no longer be considered pure. If this is not taken into account, this may lead to unexpected behavior."
                }
              }
            ]
          }
        }
      ]
    },
    "Warnings": {
      "children": []
    }
  },
  "refs": [
    "distributed",
    "distributed.semaphore.Semaphore"
  ],
  "ordered_sections": [
    "Summary",
    "Extended Summary",
    "Parameters",
    "Examples",
    "Notes"
  ],
  "item_file": "/Users/bussonniermatthias/dev/distributed/distributed/semaphore.py",
  "item_line": 270,
  "item_type": "<class 'type'>",
  "aliases": [
    "distributed.Semaphore"
  ],
  "example_section_data": {
    "children": [
      {
        "type": "Code",
        "data": {
          "entries": [
            [
              "from",
              null,
              "kn"
            ],
            [
              " ",
              "",
              ""
            ],
            [
              "distributed",
              "distributed",
              "nn"
            ],
            [
              " ",
              "",
              ""
            ],
            [
              "import",
              null,
              "kn"
            ],
            [
              " ",
              "",
              ""
            ],
            [
              "Semaphore",
              "distributed.semaphore.Semaphore",
              ""
            ],
            [
              "\n",
              "",
              ""
            ],
            [
              "\n",
              "",
              ""
            ],
            [
              "sem",
              "distributed.semaphore.Semaphore",
              ""
            ],
            [
              " ",
              "",
              ""
            ],
            [
              "=",
              "",
              "o"
            ],
            [
              " ",
              "",
              ""
            ],
            [
              "Semaphore",
              "distributed.semaphore.Semaphore",
              ""
            ],
            [
              "(",
              "",
              ""
            ],
            [
              "max_leases",
              null,
              ""
            ],
            [
              "=",
              "",
              "o"
            ],
            [
              "2",
              "",
              "mi"
            ],
            [
              ",",
              "",
              ""
            ],
            [
              " ",
              "",
              ""
            ],
            [
              "name",
              null,
              ""
            ],
            [
              "=",
              "",
              "o"
            ],
            [
              "\"",
              "",
              "s2"
            ],
            [
              "my_database",
              null,
              "s2"
            ],
            [
              "\"",
              "",
              "s2"
            ],
            [
              ")",
              "",
              ""
            ]
          ],
          "out": "...\n... def access_resource(s, sem):\n...     # This automatically acquires a lease from the semaphore (if available) which will be\n...     # released when leaving the context manager.\n...     with sem:\n...         pass\n...\n... futures = client.map(access_resource, range(10), sem=sem)\n... client.gather(futures)\n... # Once done, close the semaphore to clean up the state on scheduler side.\n... sem.close()",
          "ce_status": "compiled"
        }
      }
    ]
  },
  "see_also": [],
  "references": null,
  "signature": "Semaphore(max_leases=1, name=None, register=True, scheduler_rpc=None, loop=None)"
}