{
  "_content": {},
  "aliases": [],
  "arbitrary": [
    {
      "children": [
        {
          "data": {
            "placeholder": "target",
            "value": ".. _f2py-meson:"
          },
          "type": "Unimplemented"
        }
      ],
      "title": null
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "The key advantage gained by leveraging "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "meson"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " over the techniques described in "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "f2py-distutils"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " is that this feeds into existing systems and larger projects with ease. "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "meson"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " has a rather pythonic syntax which makes it more comfortable and amenable to extension for "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "python"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " users."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "Meson needs to be at-least "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "0.46.0"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " in order to resolve the "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "python"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " include directories."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              }
            ],
            "kind": "note",
            "title": ""
          },
          "type": "Admonition"
        }
      ],
      "title": "Using via ``meson``"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "We will need the generated "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "C"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " wrapper before we can use a general purpose build system like "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "meson"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ". We will acquire this by:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "bash",
            "content": "python -n numpy.f2py fib1.f -m fib2",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Now, consider the following "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "meson.build"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " file for the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "fib"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " and "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "scalar"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " examples from "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "f2py-getting-started"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " section:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "./../code/meson.build",
            "content": "",
            "name": "literalinclude",
            "options": [
              [
                "language",
                "meson"
              ]
            ]
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "At this point the build will complete, but the import will fail:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "bash",
            "content": "meson setup builddir\nmeson compile -C builddir\ncd builddir\npython -c 'import fib2'\nTraceback (most recent call last):\nFile \"<string>\", line 1, in <module>\nImportError: fib2.cpython-39-x86_64-linux-gnu.so: undefined symbol: FIB_\n# Check this isn't a false positive\nnm -A fib2.cpython-39-x86_64-linux-gnu.so | grep FIB_\nfib2.cpython-39-x86_64-linux-gnu.so: U FIB_",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Recall that the original example, as reproduced below, was in SCREAMCASE:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "./../code/fib1.f",
            "content": "",
            "name": "literalinclude",
            "options": [
              [
                "language",
                "fortran"
              ]
            ]
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "With the standard approach, the subroutine exposed to "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "python"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " is "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "fib"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " and not "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "FIB"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ". This means we have a few options. One approach (where possible) is to lowercase the original Fortran file with say:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "bash",
            "content": "tr \"[:upper:]\" \"[:lower:]\" < fib1.f > fib1.f\npython -n numpy.f2py fib1.f -m fib2\nmeson --wipe builddir\nmeson compile -C builddir\ncd builddir\npython -c 'import fib2'",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "However this requires the ability to modify the source which is not always possible. The easiest way to solve this is to let "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "f2py"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " deal with it:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "bash",
            "content": "python -n numpy.f2py fib1.f -m fib2 --lower\nmeson --wipe builddir\nmeson compile -C builddir\ncd builddir\npython -c 'import fib2'",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        }
      ],
      "title": "Fibonacci Walkthrough (F77)"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "A major pain point in the workflow defined above, is the manual tracking of inputs. Although it would require more effort to figure out the actual outputs for reasons discussed in "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "f2py-bldsys"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": "."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "However, we can augment our workflow in a straightforward to take into account files for which the outputs are known when the build system is set up."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "./../code/meson_upd.build",
            "content": "",
            "name": "literalinclude",
            "options": [
              [
                "language",
                "meson"
              ]
            ]
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "This can be compiled and run as before."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "bash",
            "content": "rm -rf builddir\nmeson setup builddir\nmeson compile -C builddir\ncd builddir\npython -c \"import numpy as np; import fibby; a = np.zeros(9); fibby.fib(a); print (a)\"\n# [ 0.  1.  1.  2.  3.  5.  8. 13. 21.]",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        }
      ],
      "title": "Automating wrapper generation"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "It is worth keeping in mind the following:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": [
                              "meson"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " will default to passing "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "-fimplicit-none"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " under "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "gfortran"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " by   default, which differs from that of the standard "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "np.distutils"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " behaviour"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "It is not possible to use SCREAMCASE in this context, so either the contents   of the "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              ".f"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " file or the generated wrapper "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              ".c"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " needs to be lowered to   regular letters; which can be facilitated by the "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "--lower"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " option of   "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "F2PY"
                            ]
                          },
                          "type": "Verbatim"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "BulletList"
        }
      ],
      "title": "Salient points"
    }
  ],
  "example_section_data": {
    "children": [],
    "title": null
  },
  "item_file": null,
  "item_line": null,
  "item_type": null,
  "ordered_sections": [],
  "references": null,
  "see_also": [],
  "signature": {
    "value": null
  }
}