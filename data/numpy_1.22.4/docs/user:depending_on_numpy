{
  "aliases": [],
  "arbitrary": [
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "This document aims to explain some best practices for authoring a package that depends on NumPy."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 0,
      "target": "for-downstream-package-authors",
      "title": "For downstream package authors"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "NumPy uses a standard, "
                },
                "type": "Words"
              },
              {
                "data": {
                  "target": "https://peps.python.org/pep-0440/",
                  "value": "Pep 440"
                },
                "type": "ExternalLink"
              },
              {
                "data": {
                  "value": " compliant, versioning scheme: "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "major.minor.bugfix"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ". A "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": {
                    "value": "major"
                  }
                },
                "type": "Emph"
              },
              {
                "data": {
                  "value": " release is highly unusual (NumPy is still at version "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "1.xx"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ") and if it happens it will likely indicate an ABI break. "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": {
                    "value": "Minor"
                  }
                },
                "type": "Emph"
              },
              {
                "data": {
                  "value": " versions are released regularly, typically every 6 months. Minor versions contain new features, deprecations, and removals of previously deprecated code. "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": {
                    "value": "Bugfix"
                  }
                },
                "type": "Emph"
              },
              {
                "data": {
                  "value": " releases are made even more frequently; they do not contain any new features or deprecations."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "It is important to know that NumPy, like Python itself and most other well known scientific Python projects, does "
                },
                "type": "Words"
              },
              {
                "data": {
                  "content": {
                    "value": "not"
                  }
                },
                "type": "Strong"
              },
              {
                "data": {
                  "value": " use semantic versioning. Instead, backwards incompatible API changes require deprecation warnings for at least two releases. For more details, see "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "NEP23"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": "."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "NumPy has both a Python API and a C API. The C API can be used directly or via Cython, f2py, or other such tools. If your package uses the C API, then ABI (application binary interface) stability of NumPy is important. NumPy's ABI is forward but not backward compatible. This means: binaries compiled against a given version of NumPy will still run correctly with newer NumPy versions, but not with older versions."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Understanding NumPy's versioning and API/ABI stability"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "For large, actively maintained packages that depend on NumPy, we recommend testing against the development version of NumPy in CI. To make this easy, nightly builds are provided as wheels at https://anaconda.org/scipy-wheels-nightly/. This helps detect regressions in NumPy that need fixing before the next NumPy release.  Furthermore, we recommend to raise errors on warnings in CI for this job, either all warnings or otherwise at least "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "DeprecationWarning"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " and "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "FutureWarning"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ". This gives you an early warning about changes in NumPy to adapt your code."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Testing against the NumPy main branch or pre-releases"
    },
    {
      "children": [],
      "level": 1,
      "target": null,
      "title": "Adding a dependency on NumPy"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "If a package either uses the NumPy C API directly or it uses some other tool that depends on it like Cython or Pythran, NumPy is a "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": {
                    "value": "build-time"
                  }
                },
                "type": "Emph"
              },
              {
                "data": {
                  "value": " dependency of the package. Because the NumPy ABI is only forward compatible, you must build your own binaries (wheels or other package formats) against the lowest NumPy version that you support (or an even older version)."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Picking the correct NumPy version to build against for each Python version and platform can get complicated. There are a couple of ways to do this. Build-time dependencies are specified in "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "pyproject.toml"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " (see PEP 517), which is the file used to build wheels by PEP 517 compliant tools (e.g., when using "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "pip wheel"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ")."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "You can specify everything manually in "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "pyproject.toml"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ", or you can instead rely on the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "target": "https://github.com/scipy/oldest-supported-numpy/",
                  "value": "oldest-supported-numpy"
                },
                "type": "ExternalLink"
              },
              {
                "data": {
                  "value": " metapackage. "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "oldest-supported-numpy"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " will specify the correct NumPy version at build time for wheels, taking into account Python version, Python implementation (CPython or PyPy), operating system and hardware platform. It will specify the oldest NumPy version that supports that combination of characteristics.  Note: for platforms for which NumPy provides wheels on PyPI, it will be the first version with wheels (even if some older NumPy version happens to build)."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "For conda-forge it's a little less complicated: there's dedicated handling for NumPy in build-time and runtime dependencies, so typically this is enough (see "
                },
                "type": "Words"
              },
              {
                "data": {
                  "target": "https://conda-forge.org/docs/maintainer/knowledge_base.html#building-against-numpy",
                  "value": "here"
                },
                "type": "ExternalLink"
              },
              {
                "data": {
                  "value": " for docs):      "
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "value": "host:\n  - numpy\nrun:\n  - {{ pin_compatible('numpy') }}"
          },
          "type": "BlockVerbatim"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "pip"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " has "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "--no-use-pep517"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " and "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "--no-build-isolation"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " flags that may ignore "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "pyproject.toml"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " or treat it differently - if users use those flags, they are responsible for installing the correct build dependencies themselves."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              },
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "conda"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " will always use "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "-no-build-isolation"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": "; dependencies for conda builds are given in the conda recipe ("
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "meta.yaml"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": "), the ones in "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "pyproject.toml"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " have no effect."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              },
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "Please do not use "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "setup_requires"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " (it is deprecated and may invoke "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "easy_install"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": ")."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              }
            ],
            "kind": "note",
            "title": ""
          },
          "type": "Admonition"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Because for NumPy you have to care about ABI compatibility, you specify the version with "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "=="
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " to the lowest supported version. For your other build dependencies you can probably be looser, however it's still important to set lower and upper bounds for each dependency. It's fine to specify either a range or a specific version for a dependency like "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "wheel"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " or "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "setuptools"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ". It's recommended to set the upper bound of the range to the latest already released version of "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "wheel"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " and "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "setuptools"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " - this prevents future releases from breaking your packages on PyPI."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 2,
      "target": null,
      "title": "Build-time dependency"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "NumPy itself and many core scientific Python packages have agreed on a schedule for dropping support for old Python and NumPy versions: "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "NEP29"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ". We recommend all packages depending on NumPy to follow the recommendations in NEP 29."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "For "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": {
                    "value": "run-time dependencies"
                  }
                },
                "type": "Emph"
              },
              {
                "data": {
                  "value": ", specify version bounds using "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "install_requires"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " in "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "setup.py"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " (assuming you use "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "numpy.distutils"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " or "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "setuptools"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " to build)."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Most libraries that rely on NumPy will not need to set an upper version bound: NumPy is careful to preserve backward-compatibility."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "That said, if you are (a) a project that is guaranteed to release frequently, (b) use a large part of NumPy's API surface, and (c) is worried that changes in NumPy may break your code, you can set an upper bound of "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "<MAJOR.MINOR + N"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " with N no less than 3, and "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "MAJOR.MINOR"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " being the current release of NumPy . If you use the NumPy C API (directly or via Cython), you can also pin the current major version to prevent ABI breakage. Note that setting an upper bound on NumPy may "
                },
                "type": "Words"
              },
              {
                "data": {
                  "target": "https://iscinumpy.dev/post/bound-version-constraints/",
                  "value": "affect the ability of your library to be installed alongside other, newer packages"
                },
                "type": "ExternalLink"
              },
              {
                "data": {
                  "value": "."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "placeholder": "footnote",
            "value": ".. [*] The reason for setting ``N=3`` is that NumPy will, on the\n       rare occasion where it makes breaking changes, raise warnings\n       for at least two releases. (NumPy releases about once every six\n       months, so this translates to a window of at least a year;\n       hence the subsequent requirement that your project releases at\n       least on that cadence.)"
          },
          "type": "Unimplemented"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "SciPy has more documentation on how it builds wheels and deals with its build-time and runtime dependencies "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "domain": null,
                        "role": null,
                        "value": "here <https://scipy.github.io/devdocs/dev/core-dev/index.html#distributing>"
                      },
                      "type": "Directive"
                    },
                    {
                      "data": {
                        "value": "."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              },
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "NumPy and SciPy wheel build CI may also be useful as a reference, it can be found "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "domain": null,
                        "role": null,
                        "value": "here for NumPy <https://github.com/MacPython/numpy-wheels>"
                      },
                      "type": "Directive"
                    },
                    {
                      "data": {
                        "value": " and "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "domain": null,
                        "role": null,
                        "value": "here for SciPy <https://github.com/MacPython/scipy-wheels>"
                      },
                      "type": "Directive"
                    },
                    {
                      "data": {
                        "value": "."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              }
            ],
            "kind": "note",
            "title": ""
          },
          "type": "Admonition"
        }
      ],
      "level": 2,
      "target": null,
      "title": "Runtime dependency & version ranges"
    }
  ],
  "content": {},
  "example_section_data": {
    "children": [],
    "level": 0,
    "target": null,
    "title": null
  },
  "item_file": null,
  "item_line": null,
  "item_type": null,
  "ordered_sections": [],
  "references": null,
  "see_also": [],
  "signature": {
    "value": null
  }
}