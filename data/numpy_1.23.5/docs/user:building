{
  "aliases": [],
  "arbitrary": [
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "Building locally on your machine gives you complete control over build options. If you are a MacOS or Linux user familiar with using the command line, you can continue with building NumPy locally by following the instructions below."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "children": [
                {
                  "type": "text",
                  "value": "note If you want to build NumPy for development purposes, please refer to"
                }
              ],
              "type": "admonitionTitle"
            },
            {
              "children": [
                {
                  "domain": null,
                  "role": "ref",
                  "type": "Directive",
                  "value": "development-environment"
                },
                {
                  "type": "text",
                  "value": " for additional information."
                }
              ],
              "type": "paragraph"
            }
          ],
          "kind": "note",
          "type": "admonition"
        },
        {
          "type": "mystComment",
          "value": "..\n  This page is referenced from numpy/numpy/__init__.py. Please keep its\n  location in sync with the link there."
        }
      ],
      "level": 0,
      "target": "building-from-source",
      "title": "Building from source",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "Building NumPy requires the following software installed:"
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "Python 3.9.x or newer"
                    }
                  ],
                  "type": "paragraph"
                },
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "Please note that the Python development headers also need to be installed,    e.g., on Debian/Ubuntu one needs to install both "
                    },
                    {
                      "domain": null,
                      "role": null,
                      "type": "Directive",
                      "value": "python3"
                    },
                    {
                      "type": "text",
                      "value": " and    "
                    },
                    {
                      "domain": null,
                      "role": null,
                      "type": "Directive",
                      "value": "python3-dev"
                    },
                    {
                      "type": "text",
                      "value": ". On Windows and macOS this is normally not an issue."
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "Compilers"
                    }
                  ],
                  "type": "paragraph"
                },
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "Much of NumPy is written in C.  You will need a C compiler that complies    with the C99 standard."
                    }
                  ],
                  "type": "paragraph"
                },
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "Part of Numpy is now written in C++. You will also need a C++ compiler that    complies with the C++11 standard."
                    }
                  ],
                  "type": "paragraph"
                },
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "While a FORTRAN 77 compiler is not necessary for building NumPy, it is    needed to run the "
                    },
                    {
                      "type": "inlineCode",
                      "value": "numpy.f2py"
                    },
                    {
                      "type": "text",
                      "value": " tests. These tests are skipped if the    compiler is not auto-detected."
                    }
                  ],
                  "type": "paragraph"
                },
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "Note that NumPy is developed mainly using GNU compilers and tested on    MSVC and Clang compilers. Compilers from other vendors such as Intel,    Absoft, Sun, NAG, Compaq, Vast, Portland, Lahey, HP, IBM are only    supported in the form of community feedback, and may not work out of the    box.  GCC 6.5 (and later) compilers are recommended. On ARM64 (aarch64)    GCC 8.x (and later) are recommended."
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "Linear Algebra libraries"
                    }
                  ],
                  "type": "paragraph"
                },
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "NumPy does not require any external linear algebra libraries to be    installed. However, if these are available, NumPy's setup script can detect    them and use them for building. A number of different LAPACK library setups    can be used, including optimized LAPACK libraries such as OpenBLAS or MKL.    The choice and location of these libraries as well as include paths and    other such build options can be specified in a "
                    },
                    {
                      "type": "inlineCode",
                      "value": "site.cfg"
                    },
                    {
                      "type": "text",
                      "value": " file located in    the NumPy root repository or a "
                    },
                    {
                      "type": "inlineCode",
                      "value": ".numpy-site.cfg"
                    },
                    {
                      "type": "text",
                      "value": " file in your home    directory. See the "
                    },
                    {
                      "type": "inlineCode",
                      "value": "site.cfg.example"
                    },
                    {
                      "type": "text",
                      "value": " example file included in the NumPy    repository or sdist for documentation, and below for specifying search    priority from environmental variables."
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "Cython"
                    }
                  ],
                  "type": "paragraph"
                },
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "For building NumPy, you'll need a recent version of Cython."
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "The NumPy source code"
                    }
                  ],
                  "type": "paragraph"
                },
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "Clone the repository following the instructions in "
                    },
                    {
                      "type": "inlineCode",
                      "value": "/dev/index"
                    },
                    {
                      "type": "text",
                      "value": "."
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            }
          ],
          "ordered": true,
          "spread": false,
          "start": 1,
          "type": "list"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Prerequisites",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "To install NumPy, run      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "pip install ."
        },
        {
          "children": [
            {
              "type": "text",
              "value": "To perform an in-place build that can be run from the source folder run      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "python setup.py build_ext --inplace"
        },
        {
          "children": [
            {
              "children": [
                {
                  "type": "text",
                  "value": "Note: for build instructions to do development work on NumPy itself, see"
                }
              ],
              "type": "emphasis"
            },
            {
              "type": "text",
              "value": " "
            },
            {
              "type": "inlineCode",
              "value": "development-environment"
            },
            {
              "type": "text",
              "value": "."
            }
          ],
          "type": "paragraph"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Basic Installation",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "Make sure to test your builds. To ensure everything stays in shape, see if all tests pass."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "The test suite requires additional dependencies, which can easily be  installed with      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "$ python -m pip install -r test_requirements.txt"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "Run tests      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "$ python runtests.py -v -m full"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "For detailed info on testing, see "
            },
            {
              "type": "inlineCode",
              "value": "testing-builds"
            },
            {
              "type": "text",
              "value": "."
            }
          ],
          "type": "paragraph"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Testing",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "It's possible to do a parallel build with      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "python setup.py build -j 4 install --prefix $HOME/.local"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "This will compile numpy on 4 CPUs and install it into the specified prefix. to perform a parallel in-place build, run      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "python setup.py build_ext --inplace -j 4"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "The number of build jobs can also be specified via the environment variable "
            },
            {
              "type": "inlineCode",
              "value": "NPY_NUM_BUILD_JOBS"
            },
            {
              "type": "text",
              "value": "."
            }
          ],
          "type": "paragraph"
        }
      ],
      "level": 2,
      "target": "parallel-builds",
      "title": "Parallel builds",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "Compilers are auto-detected; building with a particular compiler can be done with "
            },
            {
              "type": "inlineCode",
              "value": "--fcompiler"
            },
            {
              "type": "text",
              "value": ".  E.g. to select gfortran      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "python setup.py build --fcompiler=gnu95"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "For more information see      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "python setup.py build --help-fcompiler"
        }
      ],
      "level": 2,
      "target": null,
      "title": "Choosing the fortran compiler",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "One relatively simple and reliable way to check for the compiler used to build a library is to use ldd on the library. If libg2c.so is a dependency, this means that g77 has been used (note: g77 is no longer supported for building NumPy). If libgfortran.so is a dependency, gfortran has been used. If both are dependencies, this means both have been used, which is almost always a very bad idea."
            }
          ],
          "type": "paragraph"
        }
      ],
      "level": 2,
      "target": null,
      "title": "How to check the ABI of BLAS/LAPACK libraries",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "NumPy searches for optimized linear algebra libraries such as BLAS and LAPACK. There are specific orders for searching these libraries, as described below and in the "
            },
            {
              "type": "inlineCode",
              "value": "site.cfg.example"
            },
            {
              "type": "text",
              "value": " file."
            }
          ],
          "type": "paragraph"
        }
      ],
      "level": 1,
      "target": "accelerated-blas-lapack-libraries",
      "title": "Accelerated BLAS/LAPACK libraries",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "Note that both BLAS and CBLAS interfaces are needed for a properly optimized build of NumPy."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "The default order for the libraries are:"
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "MKL"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "BLIS"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "OpenBLAS"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "ATLAS"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "BLAS (NetLIB)"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            }
          ],
          "ordered": true,
          "spread": false,
          "start": 1,
          "type": "list"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "The detection of BLAS libraries may be bypassed by defining the environment variable "
            },
            {
              "type": "inlineCode",
              "value": "NPY_BLAS_LIBS"
            },
            {
              "type": "text",
              "value": " , which should contain the exact linker flags you want to use (interface is assumed to be Fortran 77).  Also define "
            },
            {
              "type": "inlineCode",
              "value": "NPY_CBLAS_LIBS"
            },
            {
              "type": "text",
              "value": " (even empty if CBLAS is contained in your BLAS library) to trigger use of CBLAS and avoid slow fallback code for matrix calculations."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "If you wish to build against OpenBLAS but you also have BLIS available one may predefine the order of searching via the environment variable "
            },
            {
              "type": "inlineCode",
              "value": "NPY_BLAS_ORDER"
            },
            {
              "type": "text",
              "value": " which is a comma-separated list of the above names which is used to determine what to search for, for instance        "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "NPY_BLAS_ORDER=ATLAS,blis,openblas,MKL python setup.py build"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "will prefer to use ATLAS, then BLIS, then OpenBLAS and as a last resort MKL. If neither of these exists the build will fail (names are compared lower case)."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "Alternatively one may use "
            },
            {
              "type": "inlineCode",
              "value": "!"
            },
            {
              "type": "text",
              "value": " or "
            },
            {
              "type": "inlineCode",
              "value": "^"
            },
            {
              "type": "text",
              "value": " to negate all items          "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "NPY_BLAS_ORDER='^blas,atlas' python setup.py build"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "will allow using anything "
            },
            {
              "children": [
                {
                  "type": "text",
                  "value": "but"
                }
              ],
              "type": "strong"
            },
            {
              "type": "text",
              "value": " NetLIB BLAS and ATLAS libraries, the order of the above list is retained."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "One cannot mix negation and positives, nor have multiple negations, such cases will raise an error."
            }
          ],
          "type": "paragraph"
        }
      ],
      "level": 2,
      "target": null,
      "title": "BLAS",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "The default order for the libraries are:"
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "MKL"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "OpenBLAS"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "libFLAME"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "ATLAS"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "LAPACK (NetLIB)"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            }
          ],
          "ordered": true,
          "spread": false,
          "start": 1,
          "type": "list"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "The detection of LAPACK libraries may be bypassed by defining the environment variable "
            },
            {
              "type": "inlineCode",
              "value": "NPY_LAPACK_LIBS"
            },
            {
              "type": "text",
              "value": ", which should contain the exact linker flags you want to use (language is assumed to be Fortran 77)."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "If you wish to build against OpenBLAS but you also have MKL available one may predefine the order of searching via the environment variable "
            },
            {
              "type": "inlineCode",
              "value": "NPY_LAPACK_ORDER"
            },
            {
              "type": "text",
              "value": " which is a comma-separated list of the above names, for instance        "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "NPY_LAPACK_ORDER=ATLAS,openblas,MKL python setup.py build"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "will prefer to use ATLAS, then OpenBLAS and as a last resort MKL. If neither of these exists the build will fail (names are compared lower case)."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "Alternatively one may use "
            },
            {
              "type": "inlineCode",
              "value": "!"
            },
            {
              "type": "text",
              "value": " or "
            },
            {
              "type": "inlineCode",
              "value": "^"
            },
            {
              "type": "text",
              "value": " to negate all items          "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "NPY_LAPACK_ORDER='^lapack' python setup.py build"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "will allow using anything "
            },
            {
              "children": [
                {
                  "type": "text",
                  "value": "but"
                }
              ],
              "type": "strong"
            },
            {
              "type": "text",
              "value": " the NetLIB LAPACK library, the order of the above list is retained."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "One cannot mix negation and positives, nor have multiple negations, such cases will raise an error."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "children": [
                {
                  "type": "text",
                  "value": "deprecated 1.20"
                }
              ],
              "type": "admonitionTitle"
            },
            {
              "children": [
                {
                  "type": "text",
                  "value": "The native libraries on macOS, provided by Accelerate, are not fit for use in NumPy since they have bugs that cause wrong output under easily reproducible conditions. If the vendor fixes those bugs, the library could be reinstated, but until then users compiling for themselves should use another linear algebra library or use the built-in (but slower) default, see the next section."
                }
              ],
              "type": "paragraph"
            }
          ],
          "kind": "note",
          "type": "admonition"
        }
      ],
      "level": 2,
      "target": null,
      "title": "LAPACK",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "Usage of ATLAS and other accelerated libraries in NumPy can be disabled via      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "NPY_BLAS_ORDER= NPY_LAPACK_ORDER= python setup.py build"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "or      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "BLAS=None LAPACK=None ATLAS=None python setup.py build"
        }
      ],
      "level": 2,
      "target": null,
      "title": "Disabling ATLAS and other accelerated libraries",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "You can tell Numpy to use 64-bit BLAS/LAPACK libraries by setting the environment variable      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "NPY_USE_BLAS_ILP64=1"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "when building Numpy. The following 64-bit BLAS/LAPACK libraries are supported:"
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "OpenBLAS ILP64 with "
                    },
                    {
                      "type": "inlineCode",
                      "value": "64_"
                    },
                    {
                      "type": "text",
                      "value": " symbol suffix ("
                    },
                    {
                      "type": "inlineCode",
                      "value": "openblas64_"
                    },
                    {
                      "type": "text",
                      "value": ")"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "type": "text",
                      "value": "OpenBLAS ILP64 without symbol suffix ("
                    },
                    {
                      "type": "inlineCode",
                      "value": "openblas_ilp64"
                    },
                    {
                      "type": "text",
                      "value": ")"
                    }
                  ],
                  "type": "paragraph"
                }
              ],
              "spread": false,
              "type": "listItem"
            }
          ],
          "ordered": true,
          "spread": false,
          "start": 1,
          "type": "list"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "The order in which they are preferred is determined by "
            },
            {
              "type": "inlineCode",
              "value": "NPY_BLAS_ILP64_ORDER"
            },
            {
              "type": "text",
              "value": " and "
            },
            {
              "type": "inlineCode",
              "value": "NPY_LAPACK_ILP64_ORDER"
            },
            {
              "type": "text",
              "value": " environment variables. The default value is "
            },
            {
              "type": "inlineCode",
              "value": "openblas64_,openblas_ilp64"
            },
            {
              "type": "text",
              "value": "."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "children": [
                {
                  "type": "text",
                  "value": "note "
                }
              ],
              "type": "admonitionTitle"
            },
            {
              "children": [
                {
                  "type": "text",
                  "value": "Using non-symbol-suffixed 64-bit BLAS/LAPACK in a program that also uses 32-bit BLAS/LAPACK can cause crashes under certain conditions (e.g. with embedded Python interpreters on Linux)."
                }
              ],
              "type": "paragraph"
            },
            {
              "children": [
                {
                  "type": "text",
                  "value": "The 64-bit OpenBLAS with "
                },
                {
                  "type": "inlineCode",
                  "value": "64_"
                },
                {
                  "type": "text",
                  "value": " symbol suffix is obtained by compiling OpenBLAS with settings      "
                }
              ],
              "type": "paragraph"
            },
            {
              "type": "code",
              "value": "make INTERFACE64=1 SYMBOLSUFFIX=64_"
            },
            {
              "children": [
                {
                  "type": "text",
                  "value": "The symbol suffix avoids the symbol name clashes between 32-bit and 64-bit BLAS/LAPACK libraries."
                }
              ],
              "type": "paragraph"
            }
          ],
          "kind": "note",
          "type": "admonition"
        }
      ],
      "level": 2,
      "target": null,
      "title": "64-bit BLAS and LAPACK",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "Additional compiler flags can be supplied by setting the "
            },
            {
              "type": "inlineCode",
              "value": "OPT"
            },
            {
              "type": "text",
              "value": ", "
            },
            {
              "type": "inlineCode",
              "value": "FOPT"
            },
            {
              "type": "text",
              "value": " (for Fortran), and "
            },
            {
              "type": "inlineCode",
              "value": "CC"
            },
            {
              "type": "text",
              "value": " environment variables. When providing options that should improve the performance of the code ensure that you also set "
            },
            {
              "type": "inlineCode",
              "value": "-DNDEBUG"
            },
            {
              "type": "text",
              "value": " so that debugging code is not executed."
            }
          ],
          "type": "paragraph"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Supplying additional compiler flags",
      "type": "Section"
    },
    {
      "children": [
        {
          "children": [
            {
              "type": "text",
              "value": "Although "
            },
            {
              "type": "inlineCode",
              "value": "numpy.distutils"
            },
            {
              "type": "text",
              "value": " and "
            },
            {
              "type": "inlineCode",
              "value": "setuptools"
            },
            {
              "type": "text",
              "value": " do not directly support cross compilation, it is possible to build NumPy on one system for different architectures with minor modifications to the build environment. This may be desirable, for example, to use the power of a high-performance desktop to create a NumPy package for a low-power, single-board computer. Because the "
            },
            {
              "type": "inlineCode",
              "value": "setup.py"
            },
            {
              "type": "text",
              "value": " scripts are unaware of cross-compilation environments and tend to make decisions based on the environment detected on the build system, it is best to compile for the same type of operating system that runs on the builder. Attempting to compile a Mac version of NumPy on Windows, for example, is likely to be met with challenges not considered here."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "For the purpose of this discussion, the nomenclature adopted by "
            },
            {
              "domain": null,
              "role": null,
              "type": "Directive",
              "value": "meson"
            },
            {
              "type": "text",
              "value": " will be used: the \"build\" system is that which will be running the NumPy build process, while the \"host\" is the platform on which the compiled package will be run. A native Python interpreter, the setuptools and Cython packages and the desired cross compiler must be available for the build system. In addition, a Python interpreter and its development headers as well as any external linear algebra libraries must be available for the host platform. For convenience, it is assumed that all host software is available under a separate prefix directory, here called "
            },
            {
              "type": "inlineCode",
              "value": "$CROSS_PREFIX"
            },
            {
              "type": "text",
              "value": "."
            }
          ],
          "type": "paragraph"
        },
        {
          "placeholder": "target",
          "type": "Unimplemented",
          "value": ".. _meson: https://mesonbuild.com/Cross-compilation.html#cross-compilation"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "When building and installing NumPy for a host system, the "
            },
            {
              "type": "inlineCode",
              "value": "CC"
            },
            {
              "type": "text",
              "value": " environment variable must provide the path the cross compiler that will be used to build NumPy C extensions. It may also be necessary to set the "
            },
            {
              "type": "inlineCode",
              "value": "LDSHARED"
            },
            {
              "type": "text",
              "value": " environment variable to the path to the linker that can link compiled objects for the host system. The compiler must be told where it can find Python libraries and development headers. On Unix-like systems, this generally requires adding, "
            },
            {
              "children": [
                {
                  "type": "text",
                  "value": "e.g."
                }
              ],
              "type": "emphasis"
            },
            {
              "type": "text",
              "value": ", the following parameters to the "
            },
            {
              "type": "inlineCode",
              "value": "CFLAGS"
            },
            {
              "type": "text",
              "value": " environment variable      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "-I${CROSS_PREFIX}/usr/include\n-I${CROSS_PREFIX}/usr/include/python3.y"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "for Python version 3.y. (Replace the \"y\" in this path with the actual minor number of the installed Python runtime.) Likewise, the linker should be told where to find host libraries by adding a parameter to the "
            },
            {
              "type": "inlineCode",
              "value": "LDFLAGS"
            },
            {
              "type": "text",
              "value": " environment variable      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "-L${CROSS_PREFIX}/usr/lib"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "To make sure Python-specific system configuration options are provided for the intended host and not the build system, set      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "_PYTHON_SYSCONFIGDATA_NAME=_sysconfigdata_${ARCH_TRIPLET}"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "where "
            },
            {
              "type": "inlineCode",
              "value": "${ARCH_TRIPLET}"
            },
            {
              "type": "text",
              "value": " is an architecture-dependent suffix appropriate for the host architecture. (This should be the name of a "
            },
            {
              "type": "inlineCode",
              "value": "_sysconfigdata"
            },
            {
              "type": "text",
              "value": " file, without the "
            },
            {
              "type": "inlineCode",
              "value": ".py"
            },
            {
              "type": "text",
              "value": " extension, found in the host Python library directory.)"
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "When using external linear algebra libraries, include and library directories should be provided for the desired libraries in "
            },
            {
              "type": "inlineCode",
              "value": "site.cfg"
            },
            {
              "type": "text",
              "value": " as described above and in the comments of the "
            },
            {
              "type": "inlineCode",
              "value": "site.cfg.example"
            },
            {
              "type": "text",
              "value": " file included in the NumPy repository or sdist. In this example, set      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "include_dirs = ${CROSS_PREFIX}/usr/include\nlibrary_dirs = ${CROSS_PREFIX}/usr/lib"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "under appropriate sections of the file to allow "
            },
            {
              "type": "inlineCode",
              "value": "numpy.distutils"
            },
            {
              "type": "text",
              "value": " to find the libraries."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "As of NumPy 1.22.0, a vendored copy of SVML will be built on "
            },
            {
              "type": "inlineCode",
              "value": "x86_64"
            },
            {
              "type": "text",
              "value": " Linux hosts to provide AVX-512 acceleration of floating-point operations. When using an "
            },
            {
              "type": "inlineCode",
              "value": "x86_64"
            },
            {
              "type": "text",
              "value": " Linux build system to cross compile NumPy for hosts other than "
            },
            {
              "type": "inlineCode",
              "value": "x86_64"
            },
            {
              "type": "text",
              "value": " Linux, set the environment variable "
            },
            {
              "type": "inlineCode",
              "value": "NPY_DISABLE_SVML"
            },
            {
              "type": "text",
              "value": " to prevent the NumPy build script from incorrectly attempting to cross-compile this platform-specific library      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "NPY_DISABLE_SVML=1"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "With the environment configured, NumPy may be built as it is natively      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "python setup.py build"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "When the "
            },
            {
              "type": "inlineCode",
              "value": "wheel"
            },
            {
              "type": "text",
              "value": " package is available, the cross-compiled package may be packed into a wheel for installation on the host with      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "python setup.py bdist_wheel"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "It may be possible to use "
            },
            {
              "type": "inlineCode",
              "value": "pip"
            },
            {
              "type": "text",
              "value": " to build a wheel, but "
            },
            {
              "type": "inlineCode",
              "value": "pip"
            },
            {
              "type": "text",
              "value": " configures its own environment; adapting the "
            },
            {
              "type": "inlineCode",
              "value": "pip"
            },
            {
              "type": "text",
              "value": " environment to cross-compilation is beyond the scope of this guide."
            }
          ],
          "type": "paragraph"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "The cross-compiled package may also be installed into the host prefix for cross-compilation of other packages using, "
            },
            {
              "children": [
                {
                  "type": "text",
                  "value": "e.g."
                }
              ],
              "type": "emphasis"
            },
            {
              "type": "text",
              "value": ", the command      "
            }
          ],
          "type": "paragraph"
        },
        {
          "type": "code",
          "value": "python setup.py install --prefix=${CROSS_PREFIX}"
        },
        {
          "children": [
            {
              "type": "text",
              "value": "When cross compiling other packages that depend on NumPy, the host npy-pkg-config file must be made available. For further discussion, refer to "
            },
            {
              "domain": null,
              "role": null,
              "type": "Directive",
              "value": "numpy distutils documentation"
            },
            {
              "type": "text",
              "value": "."
            }
          ],
          "type": "paragraph"
        },
        {
          "placeholder": "target",
          "type": "Unimplemented",
          "value": ".. _numpy distutils documentation: https://numpy.org/devdocs/reference/distutils.html#numpy.distutils.misc_util.Configuration.add_npy_pkg_config"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Cross compilation",
      "type": "Section"
    }
  ],
  "content": {},
  "example_section_data": {
    "children": [],
    "level": 0,
    "target": null,
    "title": null,
    "type": "Section"
  },
  "item_file": null,
  "item_line": null,
  "item_type": null,
  "ordered_sections": [],
  "references": null,
  "see_also": [],
  "signature": {
    "type": "Signature",
    "value": null
  },
  "type": "DocBlob"
}