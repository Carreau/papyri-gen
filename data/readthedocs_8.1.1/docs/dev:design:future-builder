{
  "aliases": [],
  "arbitrary": [
    {
      "children": [
        {
          "data": {
            "argument": "",
            "content": "",
            "name": "contents",
            "options": [
              [
                "local",
                ""
              ],
              [
                "depth",
                "2"
              ]
            ]
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "This document is a continuation of Santos' work about \""
                },
                "type": "Words"
              },
              {
                "data": {
                  "domain": null,
                  "role": null,
                  "value": "Explicit Builders"
                },
                "type": "Directive"
              },
              {
                "data": {
                  "value": "\". It builds on top of that document some extra features and makes some decisions about the final goal, proposing a clear direction to move forward with intermediate steps keeping backward and forward compatibility."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "placeholder": "target",
            "value": ".. _Explicit Builders: https://github.com/readthedocs/readthedocs.org/pull/8103/"
          },
          "type": "Unimplemented"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "A lot of things have changed since this document was written. We have had multiple discussions where we already took some decisions and discarded some of the ideas/details proposed here. The document was merged as-is without a cleaned up and there could be some inconsistencies. Note that "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "build.jobs"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " and "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "build.commands"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " are already implemented "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": {
                          "value": "without definig a contract"
                        }
                      },
                      "type": "Emph"
                    },
                    {
                      "data": {
                        "value": " yet, and with small differences from the idea described here."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              },
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "Please, refer to the following links to read more about all the discussions we already had:"
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              },
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "children": [
                          {
                            "children": [
                              {
                                "data": {
                                  "children": [
                                    {
                                      "data": {
                                        "value": "Public discussions:"
                                      },
                                      "type": "Words"
                                    }
                                  ]
                                },
                                "type": "Paragraph"
                              },
                              {
                                "data": {
                                  "children": [
                                    {
                                      "children": [
                                        {
                                          "data": {
                                            "children": [
                                              {
                                                "data": {
                                                  "value": "https://github.com/readthedocs/readthedocs.org/issues/9062"
                                                },
                                                "type": "Words"
                                              }
                                            ]
                                          },
                                          "type": "Paragraph"
                                        }
                                      ]
                                    },
                                    {
                                      "children": [
                                        {
                                          "data": {
                                            "children": [
                                              {
                                                "data": {
                                                  "value": "https://github.com/readthedocs/readthedocs.org/issues/1083"
                                                },
                                                "type": "Words"
                                              }
                                            ]
                                          },
                                          "type": "Paragraph"
                                        }
                                      ]
                                    },
                                    {
                                      "children": [
                                        {
                                          "data": {
                                            "children": [
                                              {
                                                "data": {
                                                  "value": "https://github.com/readthedocs/readthedocs.org/issues/9063"
                                                },
                                                "type": "Words"
                                              }
                                            ]
                                          },
                                          "type": "Paragraph"
                                        }
                                      ]
                                    },
                                    {
                                      "children": [
                                        {
                                          "data": {
                                            "children": [
                                              {
                                                "data": {
                                                  "value": "https://github.com/readthedocs/readthedocs.org/issues/9088"
                                                },
                                                "type": "Words"
                                              }
                                            ]
                                          },
                                          "type": "Paragraph"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                "type": "BulletList"
                              }
                            ]
                          },
                          {
                            "children": [
                              {
                                "data": {
                                  "children": [
                                    {
                                      "data": {
                                        "value": "Private discussions:"
                                      },
                                      "type": "Words"
                                    }
                                  ]
                                },
                                "type": "Paragraph"
                              },
                              {
                                "data": {
                                  "children": [
                                    {
                                      "children": [
                                        {
                                          "data": {
                                            "children": [
                                              {
                                                "data": {
                                                  "value": "https://github.com/readthedocs/meta/discussions/9"
                                                },
                                                "type": "Words"
                                              }
                                            ]
                                          },
                                          "type": "Paragraph"
                                        }
                                      ]
                                    },
                                    {
                                      "children": [
                                        {
                                          "data": {
                                            "children": [
                                              {
                                                "data": {
                                                  "value": "https://github.com/readthedocs/meta/discussions/14"
                                                },
                                                "type": "Words"
                                              }
                                            ]
                                          },
                                          "type": "Paragraph"
                                        }
                                      ]
                                    },
                                    {
                                      "children": [
                                        {
                                          "data": {
                                            "children": [
                                              {
                                                "data": {
                                                  "value": "https://github.com/readthedocs/meta/discussions/17"
                                                },
                                                "type": "Words"
                                              }
                                            ]
                                          },
                                          "type": "Paragraph"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                "type": "BulletList"
                              }
                            ]
                          }
                        ]
                      },
                      "type": "BulletList"
                    }
                  ]
                },
                "type": "BlockQuote"
              }
            ],
            "kind": "note",
            "title": ""
          },
          "type": "Admonition"
        }
      ],
      "level": 0,
      "title": "Future Builder"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Keep the current builder working as-is"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Keep backward and forward (with intermediate steps) compatibility"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Define a clear support for newbie, intermediate and advanced users"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Allow users to override a command, run pre/post hook commands or define all commands by themselves"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Remove the Read the Docs requirement of having access to the build process"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Translate our current magic at build time to a defined contract with the user"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Provide a way to add a command argument without implementing it as a config file (e.g. "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "fail_on_warning"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ")"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Define a path forward towards supporting other tools"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Re-write all "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "readthedocs-sphinx-ext"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " features to post-processsing HTML features"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Reduce complexity maintained by Read the Docs' core team"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Make Read the Docs responsible for Sphinx support and delegate other tools to the community"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Eventually support upload pre-build docs"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Allow us to add a feature with a defined contract without worry about breaking old builds"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Introduce "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "build.builder: 2"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " config (does not install pre-defined packages) for these new features"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Motivate users to migrate to "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "v2"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " to finally deprecate this magic by educating users"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "BulletList"
        }
      ],
      "level": 1,
      "title": "Goals"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Read the Docs currently controls all the build process. Users are only allowed to modify very limited behavior by using a "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    ".readthedocs.yaml"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " file. This drove us to implement features like "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "sphinx.fail_on_warning"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ", "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "submodules"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ", among others, at a high implementation and maintenance cost to the core team. Besides, this hasn't been enough for more advanced users that require more control over these commands."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "This document proposes to clearly define the steps the builder ran and allow users to override them depending on their needings:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Newbie user / simple platform usage: Read the Docs controls all the commands (current builder)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Intermediate user: ability to override one or more commands plus running pre/post hooks"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Advanced user: controls "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": {
                              "value": "all the commands"
                            }
                          },
                          "type": "Emph"
                        },
                        {
                          "data": {
                            "value": " executed by the builder"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "BulletList"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "The steps identified so far are:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Checkout"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Expose project data via environment variables (\\*)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Create environment (virtualenv / conda)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Install dependencies"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Build documentation"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Generate defined contract ("
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "metadata.yaml"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ")"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Post-process HTML (\\*)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Upload to storage (\\*)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "EnumeratedList"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Steps marked with "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": {
                    "value": "(\\*)"
                  }
                },
                "type": "Emph"
              },
              {
                "data": {
                  "value": " are managed by Read the Docs and can't be overwritten."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 1,
      "title": "Steps ran by the builder"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Projects building on Read the Docs must provide a "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "metadata.yaml"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " file after running their last command. This file contains all the data required by Read the Docs to be able to add its integrations. If this file is not provided or malformed, Read the Docs will fail the build and stop the process communicating to the user that there was a problem with the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "metadata.yaml"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " and we require them to fix the problem."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "There is no restriction about how this file is generated (e.g. generated with Python, Bash, statically uploaded to the repository, etc) Read the Docs does not have control over it and it's only responsible for generating it when building with Sphinx."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              }
            ],
            "kind": "note",
            "title": ""
          },
          "type": "Admonition"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "The following is an example of a "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "metadata.yaml"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " that is generated by Read the Docs when building Sphinx documentation:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "value": "# metadata.yaml\nversion: 1\ntool:\n  name: sphinx\n  version: 3.5.1\n  builder: html\nreadthedocs:\n  html_output: ./_build/html/\n  pdf_output: ./_build/pdf/myproject.pdf\n  epub_output: ./_build/pdf/myproject.epub\n  search:\n    enabled: true\n    css_identifier: #search-form > input[name=\"q\"]\n  analytics: false\n  flyout: false\n  canonical: docs.myproject.com\n  language: en"
          },
          "type": "BlockVerbatim"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "The "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "metadata.yaml"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " contract is not defined yet. This is just an example of what we could expect from it to be able to add our integrations."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              }
            ],
            "kind": "warning",
            "title": ""
          },
          "type": "Admonition"
        }
      ],
      "level": 1,
      "title": "Defined contract"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "As we mentioned, we want all users to use the same config file and have a clear way to override commands as they need. This will be done by using the current "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    ".readthedocs.yaml"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " file that we already have by adding two new keys: "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "build.jobs"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " and "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "build.commands"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": "."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "If neither "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "build.jobs"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " or "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "build.commands"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " are present in the config file, Read the Docs will execute the builder we currently support without modification, keeping compatibility with all projects already building successfully."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "When users make usage of "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "jobs:"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " or "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "commands:"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " keys we are not responsible for them in case they fail. In these cases, we only check for a "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "metadata.yaml"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " file and run our code to add the integrations."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 1,
      "title": "Config file"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "It allows users to execute one or multiple pre/post hooks and/or overwrite one or multiple commands. These are some examples where this is useful:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "User wants to pass an extra argument to "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "sphinx-build"
                            ]
                          },
                          "type": "Verbatim"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Project requires to execute a command "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": {
                              "value": "before"
                            }
                          },
                          "type": "Emph"
                        },
                        {
                          "data": {
                            "value": " building"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "User has a personal/private PyPI URL"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Install project with "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "domain": null,
                            "role": null,
                            "value": "pip install -e"
                          },
                          "type": "Directive"
                        },
                        {
                          "data": {
                            "value": " (see https://github.com/readthedocs/readthedocs.org/issues/6243)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Disable git shallow clone (see https://github.com/readthedocs/readthedocs.org/issues/5989)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Call "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "domain": null,
                            "role": null,
                            "value": "pip install"
                          },
                          "type": "Directive"
                        },
                        {
                          "data": {
                            "value": " with "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "domain": null,
                            "role": null,
                            "value": "--constraint"
                          },
                          "type": "Directive"
                        },
                        {
                          "data": {
                            "value": " (see https://github.com/readthedocs/readthedocs.org/issues/7258)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Do something _before_ install (see https://github.com/readthedocs/readthedocs.org/issues/6662)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Use a conda lock file to create the environment (see https://github.com/readthedocs/readthedocs.org/issues/7772)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Run a check after the build is done (e.g. "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "sphinx-build -W -b linkcheck . _build/html"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ")"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Create virtualenv with "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "--system-site-packages"
                            ]
                          },
                          "type": "Verbatim"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "etc"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "BulletList"
        },
        {
          "data": {
            "value": "# .readthedocs.yaml\nbuild:\n  builder: 2\n  jobs:\n    pre_checkout:\n    checkout: git clone --branch main https://github.com/readthedocs/readthedocs.org\n    post_checkout:\n    pre_create_environment:\n    create_environment: python -m virtualenv venv\n    post_create_environment:\n    pre_install:\n    install: pip install -r requirements.txt\n    post_install:\n    pre_build:\n    build:\n      html: sphinx-build -T -j auto -E -b html -d _build/doctrees -D language=en . _build/html\n      pdf: latexmk -r latexmkrc -pdf -f -dvi- -ps- -jobname=test-builds -interaction=nonstopmode\n      epub: sphinx -T -j auto -b epub -d _build/doctrees -D language=en . _build/epub\n    post_build:\n    pre_metadata:\n    metadata: ./metadata_sphinx.py\n    post_medatada:"
          },
          "type": "BlockVerbatim"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": {
                          "value": "All these commands"
                        }
                      },
                      "type": "Emph"
                    },
                    {
                      "data": {
                        "value": " are executed passing all the exposed environment variables."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              }
            ],
            "kind": "note",
            "title": ""
          },
          "type": "Admonition"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "If the user only provides a subset of these jobs, we ran our default commands if the user does not provide them (see "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "design/future-builder:Steps ran by the builder"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": "). For example, the following YAML is enough when the project requires running Doxygen as a pre-build step:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "value": "# .readthedocs.yaml\nbuild:\n  builder: 2\n  jobs:\n    # https://breathe.readthedocs.io/en/latest/readthedocs.html#generating-doxygen-xml-files\n    pre_build: cd ../doxygen; doxygen"
          },
          "type": "BlockVerbatim"
        }
      ],
      "level": 2,
      "title": "``build.jobs``"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "It allows users to have full control over the commands executed in the build process. These are some examples where this is useful:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "project with a custom build process that does map ours"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "specific requirements that we can't/want to cover as a general rule"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "build documentation with a different tool than Sphinx"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "BulletList"
        },
        {
          "data": {
            "value": "# .readthedocs.yaml\nbuild:\n  builder: 2\n  commands:\n    - git clone --branch main https://github.com/readthedocs/readthedocs.org\n    - pip install -r requirements.txt\n    - sphinx-build -T -j auto -E -b html -d _build/doctrees -D language=en . _build/html\n    - ./metadata.py"
          },
          "type": "BlockVerbatim"
        }
      ],
      "level": 2,
      "title": "``build.commands``"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Remove all the exposed data in the "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "conf.py.tmpl"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " file and move it to "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "metadata.yaml"
                            ]
                          },
                          "type": "Verbatim"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Define structure required for "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "metadata.yaml"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " as contract"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Define the environment variables required (e.g. some from "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "html_context"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ") and execute all commands with them"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Build documentation using this contract"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Leave "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "readthedocs-sphinx-ext"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " as the only package installed and extension install in "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "conf.py.tmpl"
                            ]
                          },
                          "type": "Verbatim"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Add "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "build.builder: 2"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " config without any "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": {
                              "value": "magic"
                            }
                          },
                          "type": "Emph"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Build everything needed to support "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "build.jobs"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " and "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "build.commands"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " keys"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Write guides about how to use the new keys"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Re-write "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "readthedocs-sphinx-ext"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " features to post-process HTML features"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "EnumeratedList"
        }
      ],
      "level": 1,
      "title": "Intermediate steps for rollout"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "The migration path from "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "v1"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " to "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "v2"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " will require users to explicitly specify their requirements   (we don't install pre-defined packages anymore)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "We probably not want to support "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "build.jobs"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " on "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "v1"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " to reduce core team's time maintaining that code   without the ability to update it due to projects randomly breaking."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "We would be able to start building documentation using new tools without having to "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": {
                              "value": "integrate them"
                            }
                          },
                          "type": "Emph"
                        },
                        {
                          "data": {
                            "value": "."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Building on Read the Docs with a new tool will require:   - the user to execute a different set of commands by overriding the defaults.   - the project/build/user to expose a "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "metadata.yaml"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " with the contract that Read the Docs expects.   - none, some or all the integrations will be added to the HTML output (these have to be implemented at Read the Docs core)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "We are not responsible for extra formats (e.g. PDF, ePub, etc) on other tools."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Focus on support Sphinx with nice integrations made in a tool-agnostic way that can be re-used."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Removing the manipulation of "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "conf.py.tmpl"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " does not require us to implement the same manipulation   for projects using the new potential feature "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "sphinx.yaml"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " file."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "BulletList"
        }
      ],
      "level": 1,
      "title": "Final notes"
    }
  ],
  "content": {},
  "example_section_data": {
    "children": [],
    "level": 0,
    "title": null
  },
  "item_file": null,
  "item_line": null,
  "item_type": null,
  "ordered_sections": [],
  "references": null,
  "see_also": [],
  "signature": {
    "value": null
  }
}