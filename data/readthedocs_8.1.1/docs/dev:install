{
  "aliases": [],
  "arbitrary": [
    {
      "children": [
        {
          "data": {
            "argument": "",
            "content": "",
            "name": "meta",
            "options": [
              [
                "description lang=en",
                "Install a local development instance of Read the Docs with our step by step guide."
              ]
            ]
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "These are development setup and "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "standards <install:Core team standards>"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " that are adhered to by the core development team while developing Read the Docs and related services. If you are a contributor to Read the Docs, it might a be a good idea to follow these guidelines as well."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "To follow these instructions you will need a Unix-like operating system, or "
                },
                "type": "Words"
              },
              {
                "data": {
                  "target": "https://docs.microsoft.com/en-us/windows/wsl/",
                  "value": "Windows Subsystem for Linux (WSL)"
                },
                "type": "ExternalLink"
              },
              {
                "data": {
                  "value": ". Other operating systems are not supported."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "We do not recommend to follow this guide to deploy an instance of Read the Docs for production usage. Take into account that this setup is only useful for developing purposes."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              }
            ],
            "kind": "note",
            "title": ""
          },
          "type": "Admonition"
        }
      ],
      "level": 0,
      "title": "Development Installation"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "install "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "target": "https://www.docker.com/",
                            "value": "Docker"
                          },
                          "type": "ExternalLink"
                        },
                        {
                          "data": {
                            "value": " following "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "target": "https://docs.docker.com/install/",
                            "value": "their installation guide"
                          },
                          "type": "ExternalLink"
                        },
                        {
                          "data": {
                            "value": "."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "clone the "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "readthedocs.org"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " repository:"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "argument": "bash",
                      "content": "git clone --recurse-submodules https://github.com/readthedocs/readthedocs.org/",
                      "name": "prompt",
                      "options": []
                    },
                    "type": "BlockDirective"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "install the requirements from "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "common"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " submodule:"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "argument": "bash",
                      "content": "pip install -r common/dockerfiles/requirements.txt",
                      "name": "prompt",
                      "options": []
                    },
                    "type": "BlockDirective"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "build the Docker image for the servers:"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "children": [
                              {
                                "data": {
                                  "value": "This command could take a while to finish since it will download several Docker images."
                                },
                                "type": "Words"
                              }
                            ]
                          },
                          "type": "Paragraph"
                        }
                      ],
                      "kind": "warning",
                      "title": ""
                    },
                    "type": "Admonition"
                  },
                  {
                    "data": {
                      "argument": "bash",
                      "content": "inv docker.build",
                      "name": "prompt",
                      "options": []
                    },
                    "type": "BlockDirective"
                  },
                  {
                    "data": {
                      "argument": "",
                      "content": "If you pass the ``GITHUB_TOKEN`` and ``GITHUB_USER`` environment variables to this command,\n   it will add support for readthedocs-ext.",
                      "name": "tip",
                      "options": []
                    },
                    "type": "BlockDirective"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "pull down Docker images for the builders:"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "argument": "bash",
                      "content": "inv docker.pull --only-required",
                      "name": "prompt",
                      "options": []
                    },
                    "type": "BlockDirective"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "start all the containers:"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "argument": "bash",
                      "content": "inv docker.up  --init  # --init is only needed the first time",
                      "name": "prompt",
                      "options": []
                    },
                    "type": "BlockDirective"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "go to http://community.dev.readthedocs.io to access your local instance of Read the Docs."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "EnumeratedList"
        }
      ],
      "level": 1,
      "title": "Set up your environment"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "go to http://community.dev.readthedocs.io and check that the appearance and style looks correct    (otherwise the MinIO buckets might be misconfigured, see above)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "login as "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "admin"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " /  "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "admin"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " and verify that the project list appears"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "go to the \"Read the Docs\" project, click on the \"Build version\" button to build "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "latest"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ",    and wait until it finishes"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "click on the \"View docs\" button to browse the documentation, and verify that it works"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "EnumeratedList"
        }
      ],
      "level": 1,
      "title": "Check that everything works"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "We wrote a wrapper with "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "invoke"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " around "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "docker-compose"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " to have some shortcuts and save some work while typing docker compose commands. This section explains these "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "invoke"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " commands:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Builds the generic Docker image used by our servers (web, celery, build and proxito)."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "inv docker.build"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Starts all the containers needed to run Read the Docs completely."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "children": [
                        {
                          "children": [
                            {
                              "data": {
                                "children": [
                                  {
                                    "data": {
                                      "value": [
                                        "--no-search"
                                      ]
                                    },
                                    "type": "Verbatim"
                                  },
                                  {
                                    "data": {
                                      "value": " can be passed to disable search"
                                    },
                                    "type": "Words"
                                  }
                                ]
                              },
                              "type": "Paragraph"
                            }
                          ]
                        },
                        {
                          "children": [
                            {
                              "data": {
                                "children": [
                                  {
                                    "data": {
                                      "value": [
                                        "--init"
                                      ]
                                    },
                                    "type": "Verbatim"
                                  },
                                  {
                                    "data": {
                                      "value": " is used the first time this command is ran to run initial migrations, create an admin user, etc"
                                    },
                                    "type": "Words"
                                  }
                                ]
                              },
                              "type": "Paragraph"
                            }
                          ]
                        },
                        {
                          "children": [
                            {
                              "data": {
                                "children": [
                                  {
                                    "data": {
                                      "value": [
                                        "--no-reload"
                                      ]
                                    },
                                    "type": "Verbatim"
                                  },
                                  {
                                    "data": {
                                      "value": " makes all celery processes and django runserver       to use no reload and do not watch for files changes"
                                    },
                                    "type": "Words"
                                  }
                                ]
                              },
                              "type": "Paragraph"
                            }
                          ]
                        }
                      ]
                    },
                    "type": "BulletList"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "inv docker.up"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Opens a shell in a container (web by default)."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "children": [
                        {
                          "children": [
                            {
                              "data": {
                                "children": [
                                  {
                                    "data": {
                                      "value": [
                                        "--no-running"
                                      ]
                                    },
                                    "type": "Verbatim"
                                  },
                                  {
                                    "data": {
                                      "value": " spins up a new container and open a shell"
                                    },
                                    "type": "Words"
                                  }
                                ]
                              },
                              "type": "Paragraph"
                            }
                          ]
                        },
                        {
                          "children": [
                            {
                              "data": {
                                "children": [
                                  {
                                    "data": {
                                      "value": [
                                        "--container"
                                      ]
                                    },
                                    "type": "Verbatim"
                                  },
                                  {
                                    "data": {
                                      "value": " specifies in which container the shell is open"
                                    },
                                    "type": "Words"
                                  }
                                ]
                              },
                              "type": "Paragraph"
                            }
                          ]
                        }
                      ]
                    },
                    "type": "BulletList"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "inv docker.shell"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Executes a Django management command in a container."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "argument": "",
                      "content": "Useful when modifying models to run ``makemigrations``.",
                      "name": "tip",
                      "options": []
                    },
                    "type": "BlockDirective"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "inv docker.manage {command}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Stops and removes all containers running."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "children": [
                        {
                          "children": [
                            {
                              "data": {
                                "children": [
                                  {
                                    "data": {
                                      "value": [
                                        "--volumes"
                                      ]
                                    },
                                    "type": "Verbatim"
                                  },
                                  {
                                    "data": {
                                      "value": " will remove the volumes as well (database data will be lost)"
                                    },
                                    "type": "Words"
                                  }
                                ]
                              },
                              "type": "Paragraph"
                            }
                          ]
                        }
                      ]
                    },
                    "type": "BulletList"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "inv docker.down"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Restarts the containers specified (automatically restarts NGINX when needed)."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "inv docker.restart {containers}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Grab STDIN/STDOUT control of a running container."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "argument": "",
                      "content": "Useful to debug with ``pdb``. Once the program has stopped in your pdb line,\n    you can run ``inv docker.attach web`` and jump into a pdb session\n    (it also works with ipdb and pdb++)",
                      "name": "tip",
                      "options": []
                    },
                    "type": "BlockDirective"
                  },
                  {
                    "data": {
                      "argument": "",
                      "content": "You can hit CTRL-p CTRL-p to detach it without stopping the running process.",
                      "name": "tip",
                      "options": []
                    },
                    "type": "BlockDirective"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "inv docker.attach {container}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Runs all the test suites inside the container."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "children": [
                        {
                          "children": [
                            {
                              "data": {
                                "children": [
                                  {
                                    "data": {
                                      "value": [
                                        "--arguments"
                                      ]
                                    },
                                    "type": "Verbatim"
                                  },
                                  {
                                    "data": {
                                      "value": " will pass arguments to Tox command (e.g. "
                                    },
                                    "type": "Words"
                                  },
                                  {
                                    "data": {
                                      "value": [
                                        "--arguments \"-e py310 -- -k test_api\""
                                      ]
                                    },
                                    "type": "Verbatim"
                                  },
                                  {
                                    "data": {
                                      "value": ")"
                                    },
                                    "type": "Words"
                                  }
                                ]
                              },
                              "type": "Paragraph"
                            }
                          ]
                        }
                      ]
                    },
                    "type": "BulletList"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "inv docker.test"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Downloads and tags all the Docker images required for builders."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "children": [
                        {
                          "children": [
                            {
                              "data": {
                                "children": [
                                  {
                                    "data": {
                                      "value": [
                                        "--only-required"
                                      ]
                                    },
                                    "type": "Verbatim"
                                  },
                                  {
                                    "data": {
                                      "value": " pulls only the image "
                                    },
                                    "type": "Words"
                                  },
                                  {
                                    "data": {
                                      "value": [
                                        "ubuntu-20.04"
                                      ]
                                    },
                                    "type": "Verbatim"
                                  },
                                  {
                                    "data": {
                                      "value": "."
                                    },
                                    "type": "Words"
                                  }
                                ]
                              },
                              "type": "Paragraph"
                            }
                          ]
                        }
                      ]
                    },
                    "type": "BulletList"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "inv docker.pull"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Build all the assets and \"deploy\" them to the storage."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "inv docker.buildassets"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              }
            ]
          },
          "type": "DefList"
        }
      ],
      "level": 1,
      "title": "Working with Docker Compose"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "The Docker image for the servers is built with the requirements defined in the current checked out branch. In case you need to add a new Python dependency while developing, you can use the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "common/dockerfiles/entrypoints/common.sh"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " script as shortcut."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "This script is run at startup on all the servers (web, celery, builder, proxito) which allows you to test your dependency without re-building the whole image. To do this, add the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "pip"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " command required for your dependency in "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "common.sh"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " file:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "bash",
            "content": "# common.sh\npip install my-dependency==1.2.3",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Once the PR that adds this dependency was merged, you can rebuild the image so the dependency is added to the Docker image itself and it's not needed to be installed each time the container spins up."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 2,
      "title": "Adding a new Python dependency"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "In order to step into the worker process, you can't use "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "pdb"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " or "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "ipdb"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ", but you can use "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "celery.contrib.rdb"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ":"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "python",
            "content": "from celery.contrib import rdb; rdb.set_trace()",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "When the breakpoint is hit, the Celery worker will pause on the breakpoint and will alert you on STDOUT of a port to connect to. You can open a shell into the container with "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "inv docker.shell celery"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " (or "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "build"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ") and then use "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "telnet"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " or "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "netcat"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " to connect to the debug process port:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "bash",
            "content": "nc 127.0.0.1 6900",
            "name": "prompt",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "The "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "rdb"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " debugger is similar to "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "pdb"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ", there is no "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "ipdb"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " for remote debugging currently."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 2,
      "title": "Debugging Celery"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "These are optional steps to setup the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "connected accounts <rtd:connected-accounts>"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " (GitHub, GitLab, and BitBucket) in your development environment. This will allow you to login to your local development instance using your GitHub, Bitbucket, or GitLab credentials and this makes the process of importing repositories easier."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "However, because these services will not be able to connect back to your local development instance, "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "incoming webhooks <rtd:integrations>"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " will not function correctly. For some services, the webhooks will fail to be added when the repository is imported. For others, the webhook will simply fail to connect when there are new commits to the repository."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "/_static/images/development/bitbucket-oauth-setup.png",
            "content": "Configuring an OAuth consumer for local development on Bitbucket",
            "name": "figure",
            "options": [
              [
                "align",
                "center"
              ],
              [
                "figwidth",
                "80%"
              ]
            ]
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Configure the applications on GitHub, Bitbucket, and GitLab.   For each of these, the callback URI is "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "http://community.dev.readthedocs.io/accounts/<provider>/login/callback/"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": "   where "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "<provider>"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " is one of "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "github"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ", "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "gitlab"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ", or "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "bitbucket_oauth2"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ".   When setup, you will be given a \"Client ID\" (also called an \"Application ID\" or just \"Key\") and a \"Secret\"."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Take the \"Client ID\" and \"Secret\" for each service and enter it in your local Django admin at:   "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "http://community.dev.readthedocs.io/admin/socialaccount/socialapp/"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ".   Make sure to apply it to the \"Site\"."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "BulletList"
        }
      ],
      "level": 2,
      "title": "Configuring connected accounts"
    },
    {
      "children": [],
      "level": 1,
      "title": "Troubleshooting"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "There are projects that do not use the default Docker image downloaded when setting up the development environment. These extra images are not downloaded by default because they are big and they are not required in all cases. However, if you are seeing the following error"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "/_static/images/development/read-the-docs-build-failing.png",
            "content": "Build failing with a generic error",
            "name": "figure",
            "options": [
              [
                "align",
                "center"
              ],
              [
                "figwidth",
                "80%"
              ]
            ]
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "and in the console where the logs are shown you see something like "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "BuildAppError: No such image: readthedocs/build:ubuntu-22.04"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ", that means the application wasn't able to find the Docker image required to build that project and it failed."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "In this case, you can run a command to download all the optional Docker images:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "bash",
            "content": "inv docker.pull",
            "name": "prompt",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "However, if you prefer to download only the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": {
                    "value": "specific"
                  }
                },
                "type": "Emph"
              },
              {
                "data": {
                  "value": " image required for that project and save some space on disk, you have to follow these steps:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "go to https://hub.docker.com/r/readthedocs/build/tags"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "find the latest tag for the image shown in the logs    (in this example is "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "readthedocs/build:ubuntu-22.04"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ", which the current latest tag on that page is "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "ubuntu-22.04-2022.03.15"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ")"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "run the Docker command to pull it:"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "argument": "bash",
                      "content": "docker pull readthedocs/build:ubuntu-22.04-2022.03.15",
                      "name": "prompt",
                      "options": []
                    },
                    "type": "BlockDirective"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "tag the downloaded Docker image for the app to findit:"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  },
                  {
                    "data": {
                      "argument": "bash",
                      "content": "docker tag readthedocs/build:ubuntu-22.04-2022.03.15 readthedocs/build:ubuntu-22.04",
                      "name": "prompt",
                      "options": []
                    },
                    "type": "BlockDirective"
                  }
                ]
              }
            ]
          },
          "type": "EnumeratedList"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Once this is done, you should be able to trigger a new build on that project and it should succeed."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 2,
      "title": "Builds fail with a generic error"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Core team members expect to have a development environment that closely approximates our production environment, in order to spot bugs and logical inconsistencies before they make their way to production."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "This solution gives us many features that allows us to have an environment closer to production:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Avoids masking bugs that could be introduced by Celery tasks in a race conditions."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": "Celery runs as a separate process"
                      },
                      "type": "Words"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "We run celery with multiple worker processes to discover race conditions     between tasks."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": "Celery runs multiple processes"
                      },
                      "type": "Words"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Docker is used for a build backend instead of the local host build backend.     There are a number of differences between the two execution methods in how     processes are executed, what is installed, and what can potentially leak     through and mask bugs -- for example, local SSH agent allowing code check     not normally possible."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": "Docker for builds"
                      },
                      "type": "Words"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "There are a number of resolution bugs and cross-domain behavior that can     only be caught by using "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "domain": null,
                            "role": null,
                            "value": "USE_SUBDOMAIN"
                          },
                          "type": "Directive"
                        },
                        {
                          "data": {
                            "value": " setting."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": "Serve documentation under a subdomain"
                      },
                      "type": "Words"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "It is recommended that Postgres be used as the default database whenever     possible, as SQLite has issues with our Django version and we use Postgres     in production.  Differences between Postgres and SQLite should be masked for     the most part however, as Django does abstract database procedures, and we     don't do any Postgres-specific operations yet."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": "PostgreSQL as a database"
                      },
                      "type": "Words"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Celery workers on our build servers do not have database access and need     to be written to use API access instead."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": "Celery is isolated from database"
                      },
                      "type": "Words"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "All the site is served via NGINX with the ability to change some configuration locally."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": "Use NGINX as web server"
                      },
                      "type": "Words"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "All static and media files are served using Minio --an emulator of S3,     which is the one used in production."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": "MinIO as Django storage backend"
                      },
                      "type": "Words"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Documentation is proxied by NGINX to El Proxito and proxied back to NGINX to be served finally.     El Proxito is a small application put in front of the documentation to serve files     from the Django Storage Backend."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": "Serve documentation via El Proxito"
                      },
                      "type": "Words"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Elasticsearch is properly configured and enabled by default.     All the documentation indexes are updated after a build is finished."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": "Search enabled by default"
                      },
                      "type": "Words"
                    }
                  ]
                }
              }
            ]
          },
          "type": "DefList"
        }
      ],
      "level": 1,
      "title": "Core team standards"
    }
  ],
  "content": {},
  "example_section_data": {
    "children": [],
    "level": 0,
    "title": null
  },
  "item_file": null,
  "item_line": null,
  "item_type": null,
  "ordered_sections": [],
  "references": null,
  "see_also": [],
  "signature": {
    "value": null
  }
}