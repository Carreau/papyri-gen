{
  "aliases": [],
  "arbitrary": [
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "Currently we don't send notifications or trigger webhooks on "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "domain": null,
                        "role": "doc",
                        "value": "builds from pull requests </pull-requests>"
                      },
                      "type": "Directive"
                    },
                    {
                      "data": {
                        "value": "."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              }
            ],
            "kind": "note",
            "title": ""
          },
          "type": "Admonition"
        }
      ],
      "level": 0,
      "target": null,
      "title": "Build Notifications and Webhooks"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Read the Docs allows you to configure emails that can be sent on failing builds. This makes sure you know when your builds have failed."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Take these steps to enable build notifications using email:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Go to "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "domain": null,
                            "role": "guilabel",
                            "value": "Admin"
                          },
                          "type": "Directive"
                        },
                        {
                          "data": {
                            "value": " > "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "domain": null,
                            "role": "guilabel",
                            "value": "Notifications"
                          },
                          "type": "Directive"
                        },
                        {
                          "data": {
                            "value": " in your project."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Fill in the "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "content": {
                              "value": "Email"
                            }
                          },
                          "type": "Strong"
                        },
                        {
                          "data": {
                            "value": " field under the "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "content": {
                              "value": "New Email Notifications"
                            }
                          },
                          "type": "Strong"
                        },
                        {
                          "data": {
                            "value": " heading"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Submit the form"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "BulletList"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "You should now get notified by email when your builds fail!"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Email notifications"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Read the Docs can also send webhooks when builds are triggered, successful or failed."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Take these steps to enable build notifications using a webhook:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Go to "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "domain": null,
                            "role": "guilabel",
                            "value": "Admin"
                          },
                          "type": "Directive"
                        },
                        {
                          "data": {
                            "value": " > "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "domain": null,
                            "role": "guilabel",
                            "value": "Webhooks"
                          },
                          "type": "Directive"
                        },
                        {
                          "data": {
                            "value": " in your project."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Fill in the "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "content": {
                              "value": "URL"
                            }
                          },
                          "type": "Strong"
                        },
                        {
                          "data": {
                            "value": " field and select what events will trigger the webhook"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Modify the payload or leave the default (see below)"
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Click on "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "domain": null,
                            "role": "guilabel",
                            "value": "Save"
                          },
                          "type": "Directive"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "BulletList"
        },
        {
          "data": {
            "argument": "/_static/images/webhooks-events.png",
            "content": "URL and events for a webhook",
            "name": "figure",
            "options": [
              [
                "align",
                "center"
              ],
              [
                "alt",
                "URL and events for a webhook"
              ]
            ]
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Every time one of the checked events triggers, Read the Docs will send a POST request to your webhook URL. The default payload will look like this:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "json",
            "content": "{\n    \"event\": \"build:triggered\",\n    \"name\": \"docs\",\n    \"slug\": \"docs\",\n    \"version\": \"latest\",\n    \"commit\": \"2552bb609ca46865dc36401dee0b1865a0aee52d\",\n    \"build\": \"15173336\",\n    \"start_date\": \"2021-11-03T16:23:14\",\n    \"build_url\": \"https://readthedocs.org/projects/docs/builds/15173336/\",\n    \"docs_url\": \"https://docs.readthedocs.io/en/latest/\"\n}",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "When a webhook is sent, a new entry will be added to the \"Recent Activity\" table. By clicking on each individual entry, you will see the server response, the webhook request, and the payload."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "/_static/images/webhooks-activity.png",
            "content": "Activity of a webhook",
            "name": "figure",
            "options": [
              [
                "align",
                "center"
              ],
              [
                "alt",
                "Activity of a webhook"
              ]
            ]
          },
          "type": "BlockDirective"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Build Status Webhooks"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "You can customize the payload of the webhook to suit your needs, as long as it is valid JSON. Below you have a couple of examples, and in the following section you will find all the available variables."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "/_static/images/webhooks-payload.png",
            "content": "Custom payload",
            "name": "figure",
            "options": [
              [
                "width",
                "80%"
              ],
              [
                "align",
                "center"
              ],
              [
                "alt",
                "Custom payload"
              ]
            ]
          },
          "type": "BlockDirective"
        }
      ],
      "level": 2,
      "target": null,
      "title": "Custom payload examples"
    },
    {
      "children": [
        {
          "data": {
            "argument": "json",
            "content": "{\n  \"attachments\": [\n    {\n      \"color\": \"#db3238\",\n      \"blocks\": [\n        {\n          \"type\": \"section\",\n          \"text\": {\n            \"type\": \"mrkdwn\",\n            \"text\": \"*Read the Docs build failed*\"\n          }\n        },\n        {\n          \"type\": \"section\",\n          \"fields\": [\n            {\n              \"type\": \"mrkdwn\",\n              \"text\": \"*Project*: <{{ project.url }}|{{ project.name }}>\"\n            },\n            {\n              \"type\": \"mrkdwn\",\n              \"text\": \"*Version*: {{ version.name }} ({{ build.commit }})\"\n            },\n            {\n              \"type\": \"mrkdwn\",\n              \"text\": \"*Build*: <{{ build.url }}|{{ build.id }}>\"\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "More information on "
                },
                "type": "Words"
              },
              {
                "data": {
                  "target": "https://api.slack.com/messaging/webhooks",
                  "value": "the Slack Incoming Webhooks documentation"
                },
                "type": "ExternalLink"
              },
              {
                "data": {
                  "value": "."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 3,
      "target": null,
      "title": "Slack"
    },
    {
      "children": [
        {
          "data": {
            "argument": "json",
            "content": "{\n  \"username\": \"Read the Docs\",\n  \"content\": \"Read the Docs build failed\",\n  \"embeds\": [\n    {\n      \"title\": \"Build logs\",\n      \"url\": \"{{ build.url }}\",\n      \"color\": 15258703,\n      \"fields\": [\n        {\n          \"name\": \"*Project*\",\n          \"value\": \"{{ project.url }}\",\n          \"inline\": true\n        },\n        {\n          \"name\": \"*Version*\",\n          \"value\": \"{{ version.name }} ({{ build.commit }})\",\n          \"inline\": true\n        },\n        {\n          \"name\": \"*Build*\",\n          \"value\": \"{{ build.url }}\"\n        }\n      ]\n    }\n  ]\n}",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "More information on "
                },
                "type": "Words"
              },
              {
                "data": {
                  "target": "https://support.discord.com/hc/en-us/articles/228383668-Intro-to-Webhooks",
                  "value": "the Discord webhooks documentation"
                },
                "type": "ExternalLink"
              },
              {
                "data": {
                  "value": "."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 3,
      "target": null,
      "title": "Discord"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Event that triggered the webhook, one of "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "build:triggered"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ", "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "build:failed"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ", or "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "build:passed"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": "."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ event }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Build ID."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ build.id }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Commit corresponding to the build, if present (otherwise "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "\"\""
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ")."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ build.commit }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "URL of the build, for example "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "https://readthedocs.org/projects/docs/builds/15173336/"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": "."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ build.url }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "URL of the documentation corresponding to the build,   for example "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "https://docs.readthedocs.io/en/latest/"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": "."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ build.docs_url }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Start date of the build (UTC, ISO format), for example "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "2021-11-03T16:23:14"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": "."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ build.start_date }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Organization name (Commercial only)."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ organization.name }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Organization slug (Commercial only)."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ organization.slug }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Project slug."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ project.slug }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Project name."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ project.name }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "URL of the project "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "dashboard"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": "."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ project.url }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Version slug."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ version.slug }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              },
              {
                "dd": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Version name."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ],
                "dt": {
                  "children": [
                    {
                      "data": {
                        "value": [
                          "{{ version.name }}"
                        ]
                      },
                      "type": "Verbatim"
                    }
                  ]
                }
              }
            ]
          },
          "type": "DefList"
        }
      ],
      "level": 2,
      "target": null,
      "title": "Variable substitutions reference"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "After you add a new webhook, Read the Docs will generate a secret key for it and uses it to generate a hash signature (HMAC-SHA256) for each payload that is included in the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "X-Hub-Signature"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " header of the request."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "/_static/images/webhooks-secret.png",
            "content": "Webhook secret",
            "name": "figure",
            "options": [
              [
                "width",
                "80%"
              ],
              [
                "align",
                "center"
              ],
              [
                "alt",
                "Webhook secret"
              ]
            ]
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "We highly recommend using this signature to verify that the webhook is coming from Read the Docs. To do so, you can add some custom code on your server, like this:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "python",
            "content": "import hashlib\nimport hmac\nimport os\n\n\ndef verify_signature(payload, request_headers):\n    \"\"\"\n    Verify that the signature of payload is the same as the one coming from request_headers.\n    \"\"\"\n    digest = hmac.new(\n        key=os.environ[\"WEBHOOK_SECRET\"].encode(),\n        msg=payload.encode(),\n        digestmod=hashlib.sha256,\n    )\n    expected_signature = digest.hexdigest()\n\n    return hmac.compare_digest(\n        request_headers[\"X-Hub-Signature\"].encode(),\n        expected_signature.encode(),\n    )",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        }
      ],
      "level": 2,
      "target": null,
      "title": "Validating the payload"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Webhooks created before the custom payloads functionality was added to Read the Docs send a payload with the following structure:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "json",
            "content": "{\n    \"name\": \"Read the Docs\",\n    \"slug\": \"rtd\",\n    \"build\": {\n        \"id\": 6321373,\n        \"commit\": \"e8dd17a3f1627dd206d721e4be08ae6766fda40\",\n        \"state\": \"finished\",\n        \"success\": false,\n        \"date\": \"2017-02-15 20:35:54\"\n    }\n}",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "To migrate to the new webhooks and keep a similar structure, you can use this payload:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "json",
            "content": "{\n    \"name\": \"{{ project.name }}\",\n    \"slug\": \"{{ project.slug }}\",\n    \"build\": {\n        \"id\": \"{{ build.id }}\",\n        \"commit\": \"{{ build.commit }}\",\n        \"state\": \"{{ event }}\",\n        \"date\": \"{{ build.start_date }}\"\n    }\n}",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        }
      ],
      "level": 2,
      "target": null,
      "title": "Legacy webhooks"
    }
  ],
  "content": {},
  "example_section_data": {
    "children": [],
    "level": 0,
    "target": null,
    "title": null
  },
  "item_file": null,
  "item_line": null,
  "item_type": null,
  "ordered_sections": [],
  "references": null,
  "see_also": [],
  "signature": {
    "value": null
  }
}