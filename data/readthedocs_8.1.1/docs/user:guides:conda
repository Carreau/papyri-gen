{
  "aliases": [],
  "arbitrary": [
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Read the Docs supports Conda as an environment management tool, along with Virtualenv. Conda support is useful for people who depend on C libraries, and need them installed when building their documentation."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "This work was funded by "
                },
                "type": "Words"
              },
              {
                "data": {
                  "domain": null,
                  "role": null,
                  "value": "Clinical Graphics"
                },
                "type": "Directive"
              },
              {
                "data": {
                  "value": " -- many thanks for their support of open source."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "placeholder": "target",
            "value": ".. _Clinical Graphics: https://www.clinicalgraphics.com/"
          },
          "type": "Unimplemented"
        }
      ],
      "level": 0,
      "target": null,
      "title": "Conda Support"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Conda support is available using a "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "../config-file/index"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ", see "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "config-file/v2:conda"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": "."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Our Docker images use Miniconda, a minimal conda installer. After specifying your project requirements using a conda "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "environment.yml"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " file, Read the Docs will create the environment (using "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "conda env create"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ") and add the core dependencies needed to build the documentation."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Activating Conda"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "There are several ways of "
                },
                "type": "Words"
              },
              {
                "data": {
                  "domain": null,
                  "role": null,
                  "value": "exporting a conda environment"
                },
                "type": "Directive"
              },
              {
                "data": {
                  "value": ":"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": [
                              "conda env export"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " will produce a complete list of all the packages installed in the environment   with their exact versions. This is the best option to ensure reproducibility,   but can create problems if done from a different operative system than the target machine,   in our case Ubuntu Linux."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": [
                              "conda env export --from-history"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " will only include packages that were explicitly requested   in the environment, excluding the transitive dependencies. This is the best option to maximize   cross-platform compatibility, however it may include packages that are not needed to build your docs."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "And finally, you can also write it by hand. This allows you to pick exactly the packages needed to   build your docs (which also results in faster builds) and overcomes some limitations in the conda   exporting capabilities."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "BulletList"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "For example, using the second method for an existing environment:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "",
            "content": "$ conda activate rtd38\n(rtd38) $ conda env export --from-history | tee environment.yml\nname: rtd38\nchannels:\n  - defaults\n  - conda-forge\ndependencies:\n  - rasterio==1.2\n  - python=3.8\n  - pytorch-cpu=1.7\nprefix: /home/docs/.conda/envs/rtd38",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Read the Docs will override the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "name"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " and "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "prefix"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " of the environment when creating it, so they can have any value, or not be present at all."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "Bear in mind that ``rasterio==1.2`` (double ``==``) will install version ``1.2.0``,",
            "content": "whereas ``python=3.8`` (single ``=``) will fetch the latest ``3.8.*`` version,\nwhich is ``3.8.8`` at the time of writing.",
            "name": "tip",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "is not yet supported by default when using conda (see "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "domain": null,
                        "role": null,
                        "value": "this GitHub issue for discussion"
                      },
                      "type": "Directive"
                    },
                    {
                      "data": {
                        "value": "). If your project needs it, request that we enable the "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "value": [
                          "CONDA_APPEND_CORE_REQUIREMENTS"
                        ]
                      },
                      "type": "Verbatim"
                    },
                    {
                      "data": {
                        "value": " "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "domain": null,
                        "role": "ref",
                        "value": "feature flag <feature-flags:Feature Flags>"
                      },
                      "type": "Directive"
                    },
                    {
                      "data": {
                        "value": "."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              }
            ],
            "kind": "warning",
            "title": "Pinning Sphinx and other Read the Docs core dependencies"
          },
          "type": "Admonition"
        },
        {
          "data": {
            "placeholder": "target",
            "value": ".. _this GitHub issue for discussion: https://github.com/readthedocs/readthedocs.org/issues/3829"
          },
          "type": "Unimplemented"
        },
        {
          "data": {
            "placeholder": "target",
            "value": ".. _exporting a conda environment: https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#sharing-an-environment"
          },
          "type": "Unimplemented"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Creating the ``environment.yml``"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Conda packages are usually hosted on https://anaconda.org/, a registration-free artifact archive maintained by Anaconda Inc. Contrary to what happens with the Python Package Index, different users can potentially host the same package in the same repository, each of them using their own "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": {
                    "value": "channel"
                  }
                },
                "type": "Emph"
              },
              {
                "data": {
                  "value": ". Therefore, when installing a conda package, conda also needs to know which channels to use, and which ones take precedence."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "If not specified, conda will use "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "defaults"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ", the channel maintained by Anaconda Inc. and subject to "
                },
                "type": "Words"
              },
              {
                "data": {
                  "domain": null,
                  "role": null,
                  "value": "Anaconda Terms of Service"
                },
                "type": "Directive"
              },
              {
                "data": {
                  "value": ". It contains well-tested versions of the most widely used packages. However, some packages are not available on the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "defaults"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " channel, and even if they are, they might not be on their latest versions."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "As an alternative, there are channels maintained by the community that have a broader selection of packages and more up-to-date versions of them, the most popular one being "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "conda-forge"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": "."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "To use the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "conda-forge"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " channel when specifying your project dependencies, include it in the list of "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "channels"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " in "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "environment.yml"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ", and conda will rank them in order of appearance. To maximize compatibility, we recommend putting "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "conda-forge"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " above "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "defaults"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ":"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "yaml",
            "content": "name: rtd38\nchannels:\n  - conda-forge\n  - defaults\ndependencies:\n  - python=3.8\n  # Rest of the dependencies",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "argument": "If you want to opt out the ``defaults`` channel completely, replace it by ``nodefaults``",
            "content": "in the list of channels. See `the relevant conda docs`_ for more information.",
            "name": "tip",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "placeholder": "target",
            "value": ".. _Anaconda Terms of Service: https://www.anaconda.com/terms-of-service"
          },
          "type": "Unimplemented"
        },
        {
          "data": {
            "placeholder": "target",
            "value": ".. _the relevant conda docs: https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html?highlight=nodefaults#creating-an-environment-file-manually"
          },
          "type": "Unimplemented"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Effective use of channels"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "One important thing to note is that, when enabling the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "conda-forge"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " channel, the conda dependency solver requires a large amount of RAM and long solve times. This is "
                },
                "type": "Words"
              },
              {
                "data": {
                  "domain": null,
                  "role": null,
                  "value": "a known issue"
                },
                "type": "Directive"
              },
              {
                "data": {
                  "value": " due to the sheer amount of packages available in conda-forge."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "As an alternative, you can instruct Read the Docs to use "
                },
                "type": "Words"
              },
              {
                "data": {
                  "domain": null,
                  "role": null,
                  "value": "mamba_"
                },
                "type": "Directive"
              },
              {
                "data": {
                  "value": ", a drop-in replacement for conda that is much faster and reduces the memory consumption of the dependency solving process."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "To do that, add a "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    ".readthedocs.yaml"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "configuration file </config-file/v2>"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " with these contents:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "yaml",
            "content": "version: 2\n\nbuild:\n  os: \"ubuntu-20.04\"\n  tools:\n    python: \"mambaforge-4.10\"\n\nconda:\n  environment: environment.yml",
            "name": "code-block",
            "options": [
              [
                "caption",
                ".readthedocs.yaml"
              ]
            ]
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "You can read more about the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "config-file/v2:build.tools.python"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " configuration in our documentation."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "placeholder": "target",
            "value": ".. _mamba: https://github.com/mamba-org/mamba"
          },
          "type": "Unimplemented"
        },
        {
          "data": {
            "placeholder": "target",
            "value": ".. _a known issue: https://www.anaconda.com/understanding-and-improving-condas-performance/"
          },
          "type": "Unimplemented"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Making builds faster with mamba"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "There are valid reasons to use pip inside a conda environment: some dependency might not be available yet as a conda package in any channel, or you might want to avoid precompiled binaries entirely. In either case, it is possible to specify the subset of packages that will be installed with pip in the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "environment.yml"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " file. For example:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "yaml",
            "content": "name: rtd38\nchannels:\n  - conda-forge\n  - defaults\ndependencies:\n  - rasterio==1.2\n  - python=3.8\n  - pytorch-cpu=1.7\n  - pip>=20.1  # pip is needed as dependency\n  - pip:\n    - black==20.8b1",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "The "
                },
                "type": "Words"
              },
              {
                "data": {
                  "domain": null,
                  "role": null,
                  "value": "conda developers recommend in their best practices"
                },
                "type": "Directive"
              },
              {
                "data": {
                  "value": " to install as many requirements as possible with conda, then use pip to minimize possible conflicts and interoperability issues."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "see "
                      },
                      "type": "Words"
                    },
                    {
                      "data": {
                        "domain": null,
                        "role": null,
                        "value": "this conda issue"
                      },
                      "type": "Directive"
                    },
                    {
                      "data": {
                        "value": " for discussion."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              }
            ],
            "kind": "warning",
            "title": "Notice that ``conda env export --from-history`` does not include packages installed with pip,"
          },
          "type": "Admonition"
        },
        {
          "data": {
            "placeholder": "target",
            "value": ".. _conda developers recommend in their best practices: https://www.anaconda.com/blog/using-pip-in-a-conda-environment"
          },
          "type": "Unimplemented"
        },
        {
          "data": {
            "placeholder": "target",
            "value": ".. _this conda issue: https://github.com/conda/conda/issues/9628"
          },
          "type": "Unimplemented"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Mixing conda and pip packages"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "If your project contains extension modules written in a compiled language (C, C++, FORTRAN) or server-side JavaScript, you might need special tools to build it from source that are not readily available on our Docker images, such as a suitable compiler, CMake, Node.js, and others."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "Luckily, conda is a language-agnostic package manager, and many of these development tools are already packaged on "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "conda-forge"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " or more specialized channels."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "For example, this conda environment contains the required dependencies to compile "
                },
                "type": "Words"
              },
              {
                "data": {
                  "domain": null,
                  "role": null,
                  "value": "Slycot"
                },
                "type": "Directive"
              },
              {
                "data": {
                  "value": " on Read the Docs:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "argument": "yaml",
            "content": "name: slycot38\nchannels:\n  - conda-forge\n  - defaults\ndependencies:\n  - python=3.8\n  - cmake\n  - numpy\n  - compilers",
            "name": "code-block",
            "options": []
          },
          "type": "BlockDirective"
        },
        {
          "data": {
            "placeholder": "target",
            "value": ".. _Slycot: https://github.com/python-control/Slycot"
          },
          "type": "Unimplemented"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Compiling your project sources"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "If you have problems on the environment creation phase, either because the build runs out of memory or time or because some conflicts are found, you can try some of these mitigations:"
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Reduce the number of channels in "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "environment.yml"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ", even leaving "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "conda-forge"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": " only   and opting out of the defaults adding "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "nodefaults"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": "."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "Constrain the package versions as much as possible to reduce the solution space."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": [
                              "Use mamba <guides/conda:Making builds faster with mamba>"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": ",   an alternative package manager fully compatible with conda packages."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              },
              {
                "children": [
                  {
                    "data": {
                      "children": [
                        {
                          "data": {
                            "value": "And, if all else fails,   "
                          },
                          "type": "Words"
                        },
                        {
                          "data": {
                            "value": [
                              "request more resources <guides/build-using-too-many-resources:Requests more resources>"
                            ]
                          },
                          "type": "Verbatim"
                        },
                        {
                          "data": {
                            "value": "."
                          },
                          "type": "Words"
                        }
                      ]
                    },
                    "type": "Paragraph"
                  }
                ]
              }
            ]
          },
          "type": "BulletList"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Troubleshooting"
    },
    {
      "children": [
        {
          "data": {
            "children": [
              {
                "data": {
                  "value": "If you are running a custom installation of Read the Docs, you will need the "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "conda"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " executable installed somewhere on your "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "PATH"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": ". Because of the way "
                },
                "type": "Words"
              },
              {
                "data": {
                  "value": [
                    "conda"
                  ]
                },
                "type": "Verbatim"
              },
              {
                "data": {
                  "value": " works, we can't safely install it as a normal dependency into the normal Python virtualenv."
                },
                "type": "Words"
              }
            ]
          },
          "type": "Paragraph"
        },
        {
          "data": {
            "children": [
              {
                "data": {
                  "children": [
                    {
                      "data": {
                        "value": "making it so you can't properly activate that virtualenv anymore."
                      },
                      "type": "Words"
                    }
                  ]
                },
                "type": "Paragraph"
              }
            ],
            "kind": "warning",
            "title": "Installing conda into a virtualenv will override the ``activate`` script,"
          },
          "type": "Admonition"
        }
      ],
      "level": 1,
      "target": null,
      "title": "Custom Installs"
    }
  ],
  "content": {},
  "example_section_data": {
    "children": [],
    "level": 0,
    "target": null,
    "title": null
  },
  "item_file": null,
  "item_line": null,
  "item_type": null,
  "ordered_sections": [],
  "references": null,
  "see_also": [],
  "signature": {
    "value": null
  }
}